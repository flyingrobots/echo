# SPDX-License-Identifier: Apache-2.0
# © James Ross Ω FLYING•ROBOTS <https://github.com/flyingrobots>
# Disallow non-deterministic serialization in warp-core.
# DETERMINISM IS PARAMOUNT: Always use echo_wasm_abi::{encode_cbor, decode_cbor} for deterministic canonical encoding.
# serde_json has non-deterministic map key ordering and is completely banned from warp-core.
disallowed-methods = [
    # Disallow direct ciborium usage (use echo_wasm_abi canonical encoder instead)
    { path = "ciborium::from_reader", reason = "Use echo_wasm_abi::decode_cbor for deterministic CBOR decoding" },
    { path = "ciborium::into_writer", reason = "Use echo_wasm_abi::encode_cbor for deterministic CBOR encoding" },
    { path = "ciborium::de::from_reader", reason = "Use echo_wasm_abi::decode_cbor for deterministic CBOR decoding" },
    { path = "ciborium::ser::into_writer", reason = "Use echo_wasm_abi::encode_cbor for deterministic CBOR encoding" },
    { path = "ciborium::de::from_reader_with_buffer", reason = "Use echo_wasm_abi::decode_cbor for deterministic CBOR decoding" },

    # TOTAL BAN: serde_json is forbidden in warp-core (non-deterministic map key ordering)
    # Serialization
    { path = "serde_json::to_writer", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::to_writer_pretty", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::to_string", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::to_string_pretty", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::to_vec", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::to_vec_pretty", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::to_value", reason = "serde_json banned in warp-core - use CBOR" },
    # Deserialization
    { path = "serde_json::from_reader", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::from_str", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::from_slice", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::from_value", reason = "serde_json banned in warp-core - use CBOR" },
    # Streaming
    { path = "serde_json::Deserializer::from_reader", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::Deserializer::from_slice", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::Deserializer::from_str", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::Deserializer::into_iter", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::Serializer::new", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::Serializer::pretty", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::Serializer::with_formatter", reason = "serde_json banned in warp-core - use CBOR" },
    # Value construction/manipulation
    { path = "serde_json::json", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::Value::from", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::Map::new", reason = "serde_json banned in warp-core - use CBOR" },
    { path = "serde_json::Number::from", reason = "serde_json banned in warp-core - use CBOR" },
]

# Ban serde_json types entirely
disallowed-types = [
    { path = "serde_json::Value", reason = "serde_json types banned in warp-core - use ciborium::Value via echo_wasm_abi" },
    { path = "serde_json::Map", reason = "serde_json types banned in warp-core - use BTreeMap" },
    { path = "serde_json::Number", reason = "serde_json types banned in warp-core" },
    { path = "serde_json::Serializer", reason = "serde_json types banned in warp-core - use CBOR" },
    { path = "serde_json::Deserializer", reason = "serde_json types banned in warp-core - use CBOR" },
    { path = "serde_json::Error", reason = "serde_json types banned in warp-core - use CBOR" },
]
