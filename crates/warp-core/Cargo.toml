# SPDX-License-Identifier: Apache-2.0
# © James Ross Ω FLYING•ROBOTS <https://github.com/flyingrobots>
[package]
name = "warp-core"
version = "0.1.1"
edition = "2021"
rust-version = "1.90.0"
description = "Echo core: deterministic typed graph rewriting engine"
license = "Apache-2.0"
repository = "https://github.com/flyingrobots/echo"
readme = "README.md"
keywords = ["echo", "ecs", "deterministic", "graph"]
categories = ["game-engines", "data-structures"]
build = "build.rs"

[dependencies]
blake3 = "1.0"
bytemuck = { version = "1.14", features = ["derive", "extern_crate_std"] }
bytes = "1.0"
thiserror = "1.0"
hex = "0.4"
ciborium = "0.2"
rustc-hash = "2.1.1"
serde = { version = "1.0", features = ["derive"], optional = true }
libm = "0.2"

[dev-dependencies]
serde = { version = "1.0", features = ["derive"] }
serde-value = "0.7"
proptest = { version = "1.5" }
echo-dry-tests = { workspace = true }
echo-wasm-abi = { workspace = true }

[features]
default = []
# Optional regression check for PRNG sequences; off by default to avoid
# freezing algorithm choices. Used only in tests guarded with `cfg(feature)`.
golden_prng = []
# Enables extra diagnostic printing in deterministic trig tests.
trig_audit_print = []
# Serde support for serializable wrappers (use ONLY with deterministic CBOR encoder).
# NEVER use with serde_json - JSON is non-deterministic and banned in warp-core.
serde = ["dep:serde", "bytes/serde"]

# Scalar backend lanes (CI/test orchestration).
# - `det_float`: default float32-backed lane using `F32Scalar`.
# - `det_fixed`: fixed-point Q32.32 lane using `DFix64` (experimental, test-only).
det_float = []
det_fixed = []

# Validation feature for delta operations
delta_validate = []

# Enable footprint enforcement in release builds (normally debug-only).
# Use in CI or staging to catch footprint violations before production.
# Mutually exclusive with `unsafe_graph` (compile error if both enabled).
footprint_enforce_release = []

# DANGER: Disables footprint enforcement entirely, even in debug builds.
# Only use if you've proven enforcement overhead is unacceptable in a
# specific hot path. Removes all determinism safety checks.
# Mutually exclusive with `footprint_enforce_release`.
unsafe_graph = []

[[test]]
name = "boaw_parallel_exec"
required-features = ["delta_validate"]

[[test]]
name = "prng_golden_regression"
required-features = ["golden_prng"]

[build-dependencies]
blake3 = "1.0"
