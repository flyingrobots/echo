// SPDX-License-Identifier: Apache-2.0
// © James Ross Ω FLYING•ROBOTS <https://github.com/flyingrobots>

//! Developer utility: generate the quarter-wave `sin` LUT for deterministic trig.
//!
//! This binary is not used by the runtime. It exists to regenerate the checked-in
//! LUT in `crates/warp-core/src/math/trig_lut.rs`.
//!
//! Notes:
//! - The LUT is generated by sampling `sin` in `f64`, casting to `f32`, and
//!   storing the resulting `f32::to_bits()` value.
//! - The checked-in table is the source of truth for determinism; this tool is
//!   purely for maintenance and review.

use std::f64;

fn main() {
    const SEGMENTS: usize = 1024;
    const N: usize = SEGMENTS + 1;
    let mut bits: [u32; N] = [0; N];

    let denom = SEGMENTS as f64;
    for (i, slot) in bits.iter_mut().enumerate() {
        let a = (i as f64) * (f64::consts::FRAC_PI_2) / denom;
        let s = a.sin();
        let f = s as f32;
        *slot = f.to_bits();
    }

    // Force exact endpoints to guarantee `sin(0) = 0.0` and `sin(PI/2) = 1.0`.
    bits[0] = 0.0f32.to_bits();
    bits[SEGMENTS] = 1.0f32.to_bits();

    println!("// Generated by `cargo run -p warp-core --bin gen_sin_qtr_lut`");
    println!("// SEGMENTS = {SEGMENTS}");
    println!("pub(crate) const SIN_QTR_LUT_BITS: [u32; SIN_QTR_SEGMENTS + 1] = [");

    for chunk in bits.chunks(8) {
        print!("    ");
        for (idx, b) in chunk.iter().enumerate() {
            if idx > 0 {
                print!(", ");
            }
            print!("0x{b:08x}");
        }
        println!(",");
    }

    println!("];");
}
