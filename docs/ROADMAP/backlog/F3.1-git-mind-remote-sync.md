<!-- SPDX-License-Identifier: Apache-2.0 OR MIND-UCAL-1.0 -->
<!-- © James Ross Ω FLYING•ROBOTS <https://github.com/flyingrobots> -->

# F3.1: Remote Sync

Cross-repo federation via git-warp's CRDT capabilities. Enable git-mind instances to sync knowledge graphs across repositories so that distributed teams can collaborate on a shared knowledge base.

## T-3-1-1: git-warp remote transport for knowledge graph sync

**User Story:** As a git-mind user, I want to sync my knowledge graph with a remote git-mind instance so that distributed collaborators see the same nodes and edges.

**Requirements:**

- R1: Implement a `sync` command that connects to a remote git repo (via git-warp's remote protocol).
- R2: Merge remote knowledge graph changes using git-warp's CRDT merge semantics (LWW for node properties, union for edges).
- R3: Handle divergent histories: concurrent edits to the same node property resolve via LWW timestamp.
- R4: Report sync summary: nodes added/updated/conflicted, edges added/removed.
- R5: Support `--dry-run` flag that shows what would change without applying.

**Acceptance Criteria:**

- [ ] AC1: Two git-mind instances can sync a 100-node graph bidirectionally and converge to identical state.
- [ ] AC2: Concurrent edits to the same node property resolve deterministically via LWW.
- [ ] AC3: `--dry-run` output matches actual sync results.
- [ ] AC4: Sync works over local filesystem remotes (git-warp local transport).

**Definition of Done:**

- [ ] Code reviewed and merged
- [ ] Tests pass (CI green)
- [ ] Documentation updated (if applicable)

**Scope:** Repo: git-mind. `sync.js` module. Integration with git-warp remote transport.
**Out of Scope:** HTTP/SSH transport (uses git-warp's native transport). Conflict resolution UI. Selective sync (all-or-nothing in v1).

**Test Plan:**

- **Goldens:** Snapshot of merged graph state after a known divergent edit scenario.
- **Failures:** Unreachable remote, corrupted remote state, incompatible schema versions.
- **Edges:** Sync with empty remote, sync with identical state (no-op), sync after local delete.
- **Fuzz/Stress:** Stress test: 10 concurrent syncs against the same remote (1000 nodes each).

**Blocked By:** none
**Blocking:** T-3-3-1

**Est. Hours:** 6h
**Expected Complexity:** ~400 LoC

---

## T-3-1-2: Sync conflict reporting and resolution policy

**User Story:** As a git-mind user, I want clear reporting of sync conflicts and configurable resolution policies so that I understand what changed and can control merge behavior.

**Requirements:**

- R1: Produce a structured conflict report (JSON) listing every property conflict with local value, remote value, and resolved value.
- R2: Support resolution policies: `lww` (last-writer-wins, default), `local-wins`, `remote-wins`.
- R3: Policy is configurable per-sync via CLI flag (`--policy lww|local|remote`).
- R4: Conflict report is written to stdout (or a file via `--report-file`).

**Acceptance Criteria:**

- [ ] AC1: Conflicting edits produce a report listing both values and the resolution.
- [ ] AC2: `--policy local-wins` keeps local values for all conflicts.
- [ ] AC3: `--policy remote-wins` keeps remote values for all conflicts.
- [ ] AC4: Report JSON is parseable and includes node IDs, property names, and timestamps.

**Definition of Done:**

- [ ] Code reviewed and merged
- [ ] Tests pass (CI green)
- [ ] Documentation updated (if applicable)

**Scope:** Repo: git-mind. Conflict report generation, policy selection logic, CLI flags.
**Out of Scope:** Interactive conflict resolution UI. Per-property policy configuration. Three-way merge.

**Test Plan:**

- **Goldens:** Snapshot of conflict report JSON for a known 3-conflict scenario under each policy.
- **Failures:** Invalid policy name, report file path not writable.
- **Edges:** Zero conflicts (clean merge), all-conflict scenario, single-property conflict.
- **Fuzz/Stress:** N/A.

**Blocked By:** T-3-1-1
**Blocking:** none

**Est. Hours:** 4h
**Expected Complexity:** ~250 LoC

---
