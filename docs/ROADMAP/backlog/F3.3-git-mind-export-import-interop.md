<!-- SPDX-License-Identifier: Apache-2.0 OR MIND-UCAL-1.0 -->
<!-- © James Ross Ω FLYING•ROBOTS <https://github.com/flyingrobots> -->

# F3.3: Export/Import Interop

Federation data exchange format. Define and implement a portable format for exporting and importing knowledge graph fragments between git-mind instances, enabling workflows beyond full sync (e.g., selective sharing, archival, migration).

## T-3-3-1: Export format specification and implementation

**User Story:** As a git-mind user, I want to export a subgraph to a portable file so that I can share knowledge fragments with collaborators who may not have direct sync access.

**Requirements:**

- R1: Define a JSON-based export format (`git-mind-export/v1`) containing nodes, edges, schema constraints, and provenance metadata.
- R2: `git-mind export` command writes a subgraph (selected by node kind, label pattern, or full graph) to a `.gme` file.
- R3: Export includes content hashes for integrity verification on import.
- R4: Export format is versioned (`format_version` field) for forward compatibility.
- R5: Provenance metadata includes source repo URL, export timestamp, and exporting user.

**Acceptance Criteria:**

- [ ] AC1: `git-mind export --all` produces a `.gme` file containing all nodes and edges.
- [ ] AC2: `git-mind export --kind Person` produces a file containing only Person nodes and their incident edges.
- [ ] AC3: Export file includes `format_version: "git-mind-export/v1"` and content hashes.
- [ ] AC4: Export file is valid JSON and human-readable.

**Definition of Done:**

- [ ] Code reviewed and merged
- [ ] Tests pass (CI green)
- [ ] Documentation updated (if applicable)

**Scope:** Repo: git-mind. Export format spec (inline docs), `export.js` module, CLI `export` command.
**Out of Scope:** Import (T-3-3-2). Binary/compressed export format. Streaming export for large graphs.

**Test Plan:**

- **Goldens:** Snapshot of export file for a known 10-node graph (full export and filtered export).
- **Failures:** Export with invalid filter (unknown kind), export on empty graph.
- **Edges:** Single-node export (no edges), export with orphan edges (edges to non-exported nodes are excluded).
- **Fuzz/Stress:** Export a 10,000-node graph and verify file is valid JSON under 60 seconds.

**Blocked By:** T-3-1-1 (export format should align with sync wire format), T-3-2-1 (export includes schema constraints)
**Blocking:** T-3-3-2

**Est. Hours:** 6h
**Expected Complexity:** ~350 LoC

---

## T-3-3-2: Import with conflict detection and merge

**User Story:** As a git-mind user, I want to import a `.gme` file into my knowledge graph with conflict detection so that shared fragments merge cleanly into my existing data.

**Requirements:**

- R1: `git-mind import` reads a `.gme` file and merges its contents into the local graph.
- R2: Verify content hashes on import; reject corrupted files.
- R3: Detect conflicts: nodes with the same ID but different properties are flagged.
- R4: Support `--policy` flag (same as sync: `lww`, `local-wins`, `remote-wins`) for conflict resolution.
- R5: Validate imported nodes/edges against local schema constraints (T-3-2-1).
- R6: Report import summary: nodes added/updated/skipped, edges added/skipped, conflicts resolved.

**Acceptance Criteria:**

- [ ] AC1: Importing a `.gme` file into an empty graph creates all nodes and edges.
- [ ] AC2: Importing into a graph with overlapping nodes detects and resolves conflicts per policy.
- [ ] AC3: A corrupted `.gme` file (modified after export) is rejected with a hash mismatch error.
- [ ] AC4: Imported nodes that violate schema constraints are reported and skipped (not silently accepted).
- [ ] AC5: Import summary counts match actual changes.

**Definition of Done:**

- [ ] Code reviewed and merged
- [ ] Tests pass (CI green)
- [ ] Documentation updated (if applicable)

**Scope:** Repo: git-mind. `import.js` module, CLI `import` command. Integration with schema validator and conflict resolution.
**Out of Scope:** Streaming import. Format version migration (v1 only). Undo/rollback of import.

**Test Plan:**

- **Goldens:** Snapshot of graph state after importing a known `.gme` file into a known base graph, under each conflict policy.
- **Failures:** Corrupted file, incompatible format version, schema violations in imported data.
- **Edges:** Import into empty graph, import with zero conflicts, import with all-conflict scenario, import of a file exported from the same graph (idempotency).
- **Fuzz/Stress:** Import a 10,000-node `.gme` file and verify graph integrity under 60 seconds.

**Blocked By:** T-3-3-1
**Blocking:** none

**Est. Hours:** 6h
**Expected Complexity:** ~400 LoC
