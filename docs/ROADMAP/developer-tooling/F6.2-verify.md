<!-- SPDX-License-Identifier: Apache-2.0 OR MIND-UCAL-1.0 -->
<!-- © James Ross Ω FLYING•ROBOTS <https://github.com/flyingrobots> -->

# F6.2: verify (#48)

Snapshot integrity verification. Reads a snapshot directory, recomputes hashes, and reports mismatches.

## T-6-2-1: Verify subcommand -- hash recomputation

**User Story:** As a developer, I want to verify snapshot integrity from the CLI so that I can detect corruption or tampering.

**Requirements:**

- R1: `echo-cli verify <snapshot-path>` reads the snapshot file (WSC format or JSON depending on flag).
- R2: Recompute `state_root` from the graph data using `compute_state_root_for_warp_store`.
- R3: Recompute `commit_id` using `compute_commit_hash_v2` with the stored metadata fields.
- R4: Compare recomputed values against stored values. Report pass/fail per hash.
- R5: `--format json` outputs structured JSON: `{ "state_root": { "stored": "...", "computed": "...", "match": true }, ... }`.

**Acceptance Criteria:**

- [ ] AC1: A valid snapshot passes verification with exit code 0.
- [ ] AC2: A snapshot with a tampered `state_root` fails with exit code 1 and reports the mismatch.
- [ ] AC3: JSON output is valid JSON parseable by `jq`.
- [ ] AC4: Text output uses color (green check / red X) when stdout is a TTY, plain text otherwise.

**Definition of Done:**

- [ ] Code reviewed and merged
- [ ] Tests pass (CI green)
- [ ] Documentation updated (if applicable)

**Scope:** Hash recomputation, mismatch reporting, text/JSON output, exit codes.
**Out of Scope:** Snapshot loading from network. Batch verification of multiple snapshots. Auto-repair.

**Test Plan:**

- **Goldens:** JSON output for a known-good snapshot. JSON output for a known-bad snapshot (tampered state_root).
- **Failures:** Snapshot file not found. Snapshot file is not valid WSC/JSON. Snapshot with missing fields.
- **Edges:** Empty graph snapshot (0 nodes). Snapshot with 10,000 nodes (performance: verify completes in <1s).
- **Fuzz/Stress:** Randomly flip bytes in a valid snapshot; verify reports mismatch (never falsely passes).

**Blocked By:** T-6-1-1
**Blocking:** none

**Est. Hours:** 5h
**Expected Complexity:** ~200 LoC

---
