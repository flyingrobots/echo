<!-- SPDX-License-Identifier: Apache-2.0 OR MIND-UCAL-1.0 -->
<!-- © James Ross Ω FLYING•ROBOTS <https://github.com/flyingrobots> -->

# F9.3: Deterministic Trig Oracle (#177)

Pin error budget and verify the deterministic trig oracle for cross-OS audit. Note: issue #177 is closed, but verification and integration into the release gate remains.

---

## T-9-3-1: Verify and integrate deterministic trig oracle into release gate

**User Story:** As a release engineer, I want a CI gate that verifies the deterministic trig oracle (sin/cos) produces identical results across macOS, Ubuntu, and Alpine so that cross-OS determinism is proven before every release.

**Requirements:**

- R1: Extract the existing deterministic trig test vectors from `warp_core::math::trig` and formalize them as a golden test suite.
- R2: Define the error budget: maximum ULP (units in last place) deviation allowed between the deterministic oracle and reference values (expected: 0 ULP, since the oracle is a software implementation).
- R3: Add a CI matrix job that runs the trig golden suite on macOS, Ubuntu (glibc), and Alpine (musl).
- R4: Verify that the oracle's outputs are bit-identical across all three platforms (not just within error budget — must be exact).
- R5: Document the oracle's algorithm (LUT + refinement) and its determinism guarantees in `docs/SPEC_DETERMINISTIC_MATH.md`.

**Acceptance Criteria:**

- [ ] AC1: Golden test suite covers at least 1000 input values spanning [0, 2pi] for sin and cos.
- [ ] AC2: All 1000 values produce bit-identical results across macOS, Ubuntu, and Alpine.
- [ ] AC3: CI matrix job runs on all 3 platforms and gates the release.
- [ ] AC4: Error budget is documented as "0 ULP (bit-exact)" with rationale.
- [ ] AC5: Algorithm documentation is added to `docs/SPEC_DETERMINISTIC_MATH.md`.

**Definition of Done:**

- [ ] Code reviewed and merged
- [ ] Tests pass (CI green)
- [ ] Documentation updated (if applicable)

**Scope:** Golden test extraction, CI matrix job, cross-OS verification, documentation.
**Out of Scope:** New trig functions (atan2, tan); trig performance optimization; WASM trig verification (separate task).

**Test Plan:**

- **Goldens:** 1000-value golden vector file for sin and cos, checked into the repository.
- **Failures:** A platform producing a different bit pattern for any value (CI fails, release blocked).
- **Edges:** sin(0), sin(pi), sin(2pi), cos(0), cos(pi/2) — boundary values where naive implementations differ.
- **Fuzz/Stress:** Extended suite: 100,000 uniformly-spaced values in [0, 2pi], verified bit-identical (CI nightly).

**Blocked By:** none
**Blocking:** T-9-4-1

**Est. Hours:** 4h
**Expected Complexity:** ~300 LoC

---
