<!-- SPDX-License-Identifier: Apache-2.0 OR MIND-UCAL-1.0 -->
<!-- ¬© James Ross Œ© FLYING‚Ä¢ROBOTS <https://github.com/flyingrobots> -->
# Decision Log

*Demo outcomes should prefix the Decision column with `Demo <number> ‚Äî ‚Ä¶` to keep entries searchable.*

| Date | Context | Decision | Rationale | Consequence |
| ---- | ------- | -------- | --------- | ----------- |
| 2026-01-02 | PR hygiene: actionable review extraction | Include comment author attribution (human vs bot) and optionally include PR conversation comments + review summaries in actionable PR feedback reports so issues raised outside CodeRabbit review threads are surfaced and triaged. | Review loops often involve multiple voices and multiple comment surfaces; if the report only covers inline review threads (or only frames as ‚ÄúCodeRabbit‚Äù), human feedback and high-level review summaries can be missed. Attribution + optional wider extraction keeps triage deterministic and makes ‚Äúwho asked for what‚Äù explicit. | Reports can be triaged per reviewer/source; needs-attention counts are broken out by human vs bot and by source; full reports include URLs for quick thread navigation. |
| 2026-01-02 | Deterministic trig audit oracle (issue #177) | Replace the ignored trig ‚Äúerror budget‚Äù test‚Äôs platform-libm reference with a deterministic oracle using the pure-Rust `libm` crate, and pin explicit thresholds (max abs error vs f64 oracle + max ULP vs f32-rounded oracle for |ref| ‚â• 0.25). | Cross-platform determinism requires that CI measurements never depend on host libc/libm behavior. Separating absolute-error budgeting (good near zero) from a gated ULP budget (meaningful away from zero) yields stable, interpretable guardrails for the LUT-backed trig backend. | The trig audit test is no longer `#[ignore]` and runs in CI; changes to the trig backend that worsen accuracy will fail fast with a concrete pinned budget. |
| 2026-01-02 | Demo tooling CI coverage (issue #215) | Add a Playwright CI job that runs the Session Dashboard smoke test and uploads the Playwright report + `test-results` artifacts (without mutating tracked docs screenshots). | The embedded dashboard is demo-critical and easy to regress; Rust-only CI can‚Äôt catch breaks in embedded HTML/CSS routing, runtime wiring, or browser rendering. Publishing artifacts makes failures actionable without requiring local repro. | PRs/pushes now gate on the dashboard smoke path; failures include an attached screenshot + report bundle for rapid debugging. |
| 2026-01-01 | PR hygiene: review-loop determinism | Standardize CodeRabbitAI review triage by pinning ‚Äúactionable comments‚Äù extraction to the PR head commit, and automate it with a script that groups stale vs fresh feedback. | GitHub carries review comments forward, which makes it easy to waste time on already-fixed feedback. Treating comment extraction as a procedure (and generating a report) keeps review loops deterministic and prevents ambiguity across rounds. | PR fix batches start from a clean, reproducible actionables list; stale comments are verified against current code before any work is done; review iteration cost drops. |
| 2026-01-01 | Paper VI + roadmap hygiene (issue #180) | Add and maintain a Capability Ownership Matrix doc as a first-class artifact, alongside time-travel determinism notes, to keep ownership/determinism/provenance boundaries explicit. | As Echo grows, ‚Äúwho owns what‚Äù drifts silently; writing it down early prevents nondeterminism from leaking into the kernel and keeps tool/replay requirements grounded. | Future design and implementation work references the matrix for boundary decisions; specs and tooling tasks can be triaged against explicit determinism/provenance expectations. |
| 2026-01-01 | WVP demo hardening: review nits follow-up | Demo 1 ‚Äî Tighten loopback/publish tests to be defensively correct (overflow-safe packet sizing and explicit non-empty graph assertion) in response to CodeRabbit review feedback. | Even test-only code should not encode obvious footguns (unchecked `len + 32`) or rely on undocumented invariants without asserting them. | The test suite remains robust under adversarial framing and continues to document WVP demo assumptions explicitly. |
| 2026-01-01 | WVP demo hardening (issue #169) | Demo 1 ‚Äî Add loopback tests (service + viewer) that pin snapshot-first publish behavior, gapless epoch monotonicity, and forbidden/epoch-gap rejection. | The WVP ‚Äúhappy path‚Äù is demo-critical and easy to regress during refactors. Loopback tests provide fast feedback without requiring a real Unix socket listener or a browser/GUI harness. | `cargo test` now catches protocol regressions (authority, snapshot required, epoch gaps) and viewer publish-state bugs before they make the demo path flaky. |
| 2026-01-01 | Demo tooling: session dashboard hardening (PR #176 review) | Demo 1 ‚Äî Harden the embedded session dashboard and its smoke tests (a11y drawer `inert`, metrics fetch timeout/guard, observer backoff, and ‚Äúfail on no activity‚Äù e2e assertions). | Demo-grade tooling must degrade gracefully when upstream is unavailable and must be accessible by default; the Playwright smoke test should fail loudly on timeouts and provide useful diagnostics. | Dashboard no longer risks hanging indefinitely on `/api/metrics`; keyboard users can‚Äôt tab into a hidden drawer; hub observer reconnects with backoff on handshake/subscribe failures; e2e fails deterministically when metrics never reflect traffic. |
| 2026-01-01 | Demo tooling: keep the Session Dashboard smoke test self-contained | Demo 1 ‚Äî Add a minimal `echo-session-client` example (`publish_pulse`) so Playwright can generate deterministic snapshot+diff traffic without depending on the full GUI viewer. | The dashboard smoke test should be runnable from a clean checkout. A tiny CLI publisher makes the test deterministic (gapless epochs) and removes hidden local state (stashes/untracked files) from the workflow. | The e2e dashboard test can build `publish_pulse` and use it as its traffic generator; future contributors can reproduce ‚Äúhub + gateway + dashboard metrics‚Äù locally with a single command. |
| 2026-01-01 | Tooling UI: unify embedded dashboards without a web build | Demo 1 ‚Äî Adopt Open Props v1.7.17 (vendored CSS tokens + theme switch) as the baseline styling system for embedded dashboards served by Rust binaries. | We want consistent spacing/typography/color decisions across tooling, but we can‚Äôt afford bundler/build friction for demo-grade dashboards. Token-based CSS gets most of the benefits of a component library while staying offline and easy to embed. | The session dashboard now uses Open Props tokens + theme vars; future embedded dashboards can share the same vendor CSS under `/vendor/*.css` without introducing a separate web build step. |
| 2025-12-31 | Demo tooling: keep demos honest in CI/local runs | Demo 1 ‚Äî Add Playwright smoke tests: (1) `Session Dashboard` boots hub + gateway and asserts `/dashboard` + `/api/metrics` reflect observed WVP traffic; (2) fix the collision tour PiP `.hidden` behavior so the existing docs tests match reality. | Demo work tends to rot fastest; a black-box browser-level test catches regressions in routing, embedded assets, and observer wiring without requiring the full viewer. The collision tour failure was a CSS specificity mismatch (`.pip img` overriding `.hidden`). | Running `pnpm exec playwright test` validates both the docs tour interactions and the session dashboard/metrics flow; PiP world/graph tabs correctly hide/show images across browsers. |
| 2025-12-31 | Demo tooling: ‚Äúlook, Echo works‚Äù visibility for the WVP stack | Demo 1 ‚Äî Serve a lightweight session dashboard from `echo-session-ws-gateway` (`/dashboard` + `/api/metrics`) and include a built-in hub observer (UDS subscriber) so it shows activity even when the gateway is not in the data path. | We need immediate, zero-setup observability while iterating on WVP framing and publish/subscribe semantics. Serving UI + JSON from the existing gateway avoids CORS/build complexity and keeps the demo entrypoint as ‚Äúrun a binary, open a page.‚Äù | Local browser dashboard can display hub observer status, connection counts, byte/frame rates, decode errors, and per-warp last epoch/hash progress; metrics remain explicitly non-authoritative (observed traffic only). |
| 2026-01-01 | Motion payload determinism (v2) | Promote the motion demo payload to a deterministic Q32.32 fixed-point v2 encoding (`payload/motion/v2`, 6√ói64 LE) while preserving v0 decode compatibility (`payload/motion/v0`, 6√óf32 LE). Port the motion executor to `Scalar` and upgrade v0 payloads to v2 on write. | Motion payload bytes participate in deterministic state hashing and cross-platform replay; raw `f32` bytes reintroduce NaN payload and subnormal drift risks. Upgrading v0-on-write keeps backwards compatibility while converging stores on a stable canonical encoding. | Motion rule remains usable with legacy fixtures, but resulting state always converges to the deterministic v2 payload after the first write; non-finite values are mapped deterministically (NaN‚Üí0; ¬±‚àû saturate). |
| 2026-01-01 | Deterministic math: fixed-point lane (`DFix64`) | Introduce a deterministic fixed-point scalar (`DFix64`, Q32.32 in `i64`) behind a `det_fixed` feature flag, with saturating arithmetic and ties-to-even rounding for mul/div; add `warp-core` tests and CI lanes that run `cargo test -p warp-core --features det_fixed` (glibc + musl). | Fixed-point is a key alternative backend for determinism audits and ‚Äúno-float‚Äù environments; keeping it feature-gated and continuously tested lets us evolve it without destabilizing the default `F32Scalar` lane. | The repo gains a continuously exercised fixed-point backend; CI will catch regressions in the fixed-point surface and cross-platform compilation early (including musl). |
| 2026-01-01 | Deterministic math guardrails | Forbid raw trig calls in `warp-core` math modules (outside the deterministic trig backend + scalar wrapper surface) via a dedicated CI/script guard. | Prevents regressions where platform/libm transcendentals sneak back into runtime math, breaking cross-platform determinism. | CI fails fast if `mat4`, `quat`, etc. reintroduce `.sin/.cos/.sin_cos` calls; trig stays centralized in `warp_core::math::trig` and surfaced through scalar wrappers. |
| 2026-01-01 | Deterministic math: transcendental stability (`F32Scalar`) | Implement LUT-backed deterministic `F32Scalar::{sin,cos,sin_cos}` via a checked-in quarter-wave table + linear interpolation; add golden-vector trig tests to pin exact output bits. | Removes platform/libm variance while preserving `F32Scalar` canonicalization invariants (no `-0.0`, no subnormals, canonical NaNs). The existing ‚Äúerror budget‚Äù test remains opt-in because its reference uses platform libm. | Trig is now deterministic across supported platforms; CI can enforce stable bits via golden vectors; developers can still audit approximation error by running ignored tests explicitly. |
| 2026-01-01 | PR #167 review cleanup (deterministic math) | Tighten determinism invariants surfaced by review: enforce exact odd symmetry for sine by range-reducing `abs(angle)` and applying sign at the end; centralize signed-zero canonicalization via `trig::canonicalize_zero`; remove magic endpoint bits in the LUT generator; add tests asserting the motion executor accepts v0 payloads and upgrades to v2; document deterministic `0/0 ‚Üí 0` policy; add `// TODO(#177)` tracking for the ignored trig error-budget audit. | Code review found a 1‚ÄëULP mismatch between `sin(¬±œÄ/8)` golden vectors and flagged duplicated signed-zero handling / implicit invariants. Making symmetry and canonicalization explicit prevents bit drift and reduces the chance of reintroducing nondeterministic edge behavior. | Golden vectors for `sin(-x)` are bit-stable with `sin(x)`; canonicalization logic is centralized and reused by Mat4/Quat; motion v0 support is executable (not just documented); remaining work: convert the ignored audit test into a deterministic oracle once budgets are pinned (#177). |
| 2025-12-30 | PR #164 review follow-ups (WVP demo robustness; related: WVP demo path entry below) | Reset per-connection publish state on successful connect (force snapshot before diffs), harden handshake/outbound encoding failures (log + bail instead of writing empty packets), and add missing rustdoc/warn logs surfaced by review. | Review comments flagged a reconnect publish dead-end and ‚Äúsilent failure‚Äù risks; making failures visible and forcing snapshot-on-reconnect keeps the demo deterministic, debuggable, and aligned with missing-docs policy. | Publishing resumes after reconnect without manual toggles; protocol encode failures no longer silently write empty packets; workspace `-D warnings -D missing_docs` remains green. |
| 2025-12-30 | WARP View Protocol demo path (hub + 2 viewers) | Add a bidirectional tool connection (`connect_channels_for_bidir`) so tools can publish `warp_stream` frames, and wire `warp-viewer` with publish/receive toggles plus a deterministic demo mutation (‚Äúpulse‚Äù) that emits gapless snapshot+diff streams. Document the workflow in `docs/guide/wvp-demo.md` and mark WVP checklist items complete in `docs/tasks.md`. | WVP needs an end-to-end ‚Äúreal‚Äù demo (not just a spec): tools must be able to publish without dragging async runtimes into UI code, and publisher/subscriber roles must be testable locally. A deterministic, viewer-native mutation is the smallest way to exercise the protocol without coupling to the engine rewrite loop yet. | You can run a local hub and watch two viewers share WARP changes (publisher pulses, subscriber updates). Client and hub error surfaces are explicit via notifications/toasts; epoch gaps and forbidden publishes fail fast. Remaining follow-up: a dedicated integration test harness for multi-client loopback if/when we formalize resync/acks. |
| 2025-12-30 | Stage B1 usability/docs: make descent-chain law and portal-chain slicing concrete | Expand `docs/spec-warp-core.md` with worked Stage B1 examples (descent-chain reads ‚Üí `Footprint.a_read` ‚Üí patch `in_slots`, and portal-chain inclusion in Paper III slicing). Add `Engine::with_state(...) -> Result<Engine, EngineError>` so tools/tests can initialize an engine from an externally constructed multi-instance `WarpState` without exposing internal maps. | Stage B1 correctness depends on subtle invariants that are easy to ‚Äúget almost right‚Äù without a concrete example; documentation must prevent ‚Äúlooks right, doesn‚Äôt slice.‚Äù A state-based engine constructor is the smallest ergonomic primitive that enables multi-instance fixtures and patch-replay workflows while keeping the rewrite hot path unchanged. | Contributors can reproduce and reason about B1 behavior quickly; multi-instance demos/tests can be built via patch replay + `Engine::with_state` rather than internal mutation; the portal-chain dependency is explicit in both docs and slice behavior. |
| 2025-12-30 | Review follow-ups: receipts + wasm/ffi ergonomics + GraphStore deletes | Keep tick receipts self-describing and instance-scoped: document `TickReceiptEntry.scope` as a `NodeKey` (`warp_id`, `local_id`) and include both components in the receipt digest encoding. Add `Engine::insert_node_with_attachment` for atomic demo/bootstrap insertion and use it from WASM/FFI boundaries. Remove `delete_node_cascade`‚Äôs inbound `O(total_edges)` scan by maintaining reverse inbound edge indexes (`edges_to` + `edge_to_index`). | Receipts are used as deterministic audit artifacts: scope must be unambiguous once WARP is multi-instance. WASM/FFI callers need deterministic failure behavior and acceptable debugging signals. Delete-heavy workloads should not accidentally hit `O(total_edges)` traps when the store already maintains reverse indexes. | Receipt docs and digest encoding are clearer and stable; WASM spawn logs errors behind `console-panic` and returns a clear sentinel; FFI spawn avoids partial init; node deletion now scales with the number of incident edges rather than total graph size. |
| 2025-12-30 | Post-merge touch-ups (Stage B1): API encapsulation + semantics | Add stable id byte accessors (`NodeId::as_bytes`, `WarpId::as_bytes`), add `GraphStore::has_edge`, and tighten `Engine` accessors so ‚Äúunknown warp store‚Äù is distinguished from ‚Äúmissing node/attachment‚Äù (`Result<Option<_>, EngineError>`). Make root-store mutation helpers (`insert_node`, `set_node_attachment`) return `Result` (no silent mutation drops). | Prevent callers from depending on tuple-field internals (`.0`) and reduce coupling to internal map fields. The engine must be deterministic and explicit about failure modes; ‚Äúdrop writes in release‚Äù is a correctness hazard. Returning `Result` keeps clippy/CI gates strict without using panics/`expect`. | Call sites in wasm/ffi/benches/tests were updated to handle `Result`; patch/receipt hashing uses the stable accessors; docs now use explicit ‚Äúnode-attachment plane / edge-attachment plane‚Äù terminology. CI remains green under `-D warnings -D missing_docs`. |
| 2025-12-29 | Paper I/II two-plane semantics (SkeletonGraph + attachment plane) | Define Echo‚Äôs `warp-core` store as the **SkeletonGraph** (`œÄ(U)`), and represent attachment-plane payloads as **typed atoms**: `AtomPayload { type_id: TypeId, bytes: Bytes }` stored on `NodeRecord`/`EdgeRecord`. Update canonical hashing and tick patch encoding so payload `type_id` participates in `state_root`/`patch_digest`, and codify project laws: ‚Äúskeleton rewrites never decode attachments‚Äù + ‚Äúno hidden edges in payload bytes.‚Äù | Echo must be a faithful reference implementation of WARP‚Äôs two-plane semantics: the skeleton plane is rewrite-visible and provenance/slicing-relevant, while attachments are separate. Untyped payload bytes create safety hazards and allow ‚Äúsame bytes, different meaning‚Äù collisions at the boundary. Keeping matching/indexing skeleton-only preserves performance and prevents provenance bugs caused by hidden structure. | Terminology is clarified (SkeletonGraph vs. WarpState); payload meaning is explicit and hash-committed; decode failure is deterministic and conservative (‚Äúrule does not apply‚Äù by default); Stage B1 descended attachments are unblocked via explicit indirection rather than nested structs or payload-smuggled edges. |
| 2025-12-29 | Paper III boundary semantics (delta patches + slicing) | Implement `WarpTickPatchV1` as a **delta patch** (canonical `ops` + conservative `in_slots`/`out_slots` over unversioned slots); define value-versioning *by interpretation* along a worldline (`ValueVersionId := (slot_id, tick_index)`), not embedded in the patch; upgrade commit hashing to **v2** so `commit_id` commits only to `(parents, state_root, patch_digest, policy_id, version)` and treats plan/decision/rewrites digests + receipts as diagnostics. | Paper III‚Äôs slice/holography results require a replayable boundary artifact; recipe patches bind replay to executor semantics and do not archive cleanly across languages or evolution. Unversioned slots keep patch hashes position-independent; SSA-style value versioning is recovered from patch position in `P`. Committing only to the patch delta prevents consensus from being coupled to scheduler/planner quirks. | Commit ids become ‚Äúthis transformation‚Äù (delta) rather than ‚Äúthis scheduling narrative‚Äù; slicing becomes trivial once `producer(slot@i)` is defined by patch position; planner/receipt metadata remains available for debugging without becoming consensus-critical. |
| 2025-12-29 | Paper II tick receipts: blocking causality | Extend `TickReceipt` to record a blocking-causality witness for `Rejected(FootprintConflict)` entries (indices of the applied candidates that blocked it, in canonical plan order); keep `decision_digest` encoding stable (digest commits only to accept/reject outcomes, not blocker metadata). | Paper II‚Äôs receipts are meant to explain *why* candidates were rejected and support deterministic debugging/provenance. Blocker indices provide a minimal poset edge list without destabilizing commit hashes as explanations evolve. | Tools/tests can surface ‚Äúblocked by ‚Ä¶‚Äù explanations; receipts now carry poset edges for footprint conflicts; commit ids remain stable for identical accept/reject outcomes. |
| 2025-12-29 | warp-core follow-ups (#151/#152) | Remove ‚ÄúTODO-vibes‚Äù by making `policy_id` an explicit `Engine` parameter (default `POLICY_ID_NO_POLICY_V0`) and add a reverse edge index (`EdgeId -> from`) so tick patch replay no longer scans all edge buckets for `UpsertEdge`/migration. | `policy_id` is part of the deterministic boundary and must be configurable, not a hardcoded magic number; patch replay must scale beyond toy graphs. Maintaining the reverse index keeps replay `O(bucket_edges)` and avoids history-sensitive state roots caused by empty edge buckets. | Callers can set policy semantics explicitly; tick patch replay is no longer `O(total_edges)` per migrated edge; state hashing remains a function of graph content, not mutation history. |
| 2025-12-29 | warp-core follow-up: edge record equality | Derive `PartialEq, Eq` for `EdgeRecord` and remove the local `edge_record_eq` helper from tick patch diffing, switching to idiomatic `==`/`!=`. | Helper-based equality duplicates type semantics and can drift. Deriving equality makes record comparisons precise, portable, and single-source-of-truth. | Diffing code is smaller and less fragile; future `EdgeRecord` field changes will naturally participate in equality comparisons. |
| 2025-12-29 | warp-core follow-up: tick patch hygiene | Harden `tick_patch` boundary code: remove double map lookups in `diff_store`, expand rustdoc to document invariants and semantics, use `thiserror` for `TickPatchError`, dedupe `ops` in `WarpTickPatchV1::new`, and introduce `ContentHash` (alias for `crate::ident::Hash`) to avoid confusion with `derive(Hash)`. | Tick patches are a consensus-critical boundary artifact: code should be clear, deterministic, and resistant to misuse. Removing boilerplate and ambiguity reduces drift risk and prevents subtle replay errors (duplicate ops, mismatched tags vs sort order). | Patch construction/diffing is clearer and cheaper; errors are less boilerplate; duplicate ops cannot cause replay failures; type naming is less confusing for readers. |
| 2025-12-28 | AIŒ©N bridge doc + Paper II tick receipts | Promote the AIŒ©N Foundations bridge from `docs/notes/` into a canonical doc (`docs/aion-papers-bridge.md`, keeping a stub for historical links); implement `TickReceipt` + `Engine::commit_with_receipt` in `warp-core` and commit the receipt digest via `Snapshot.decision_digest` (encoding defined in `docs/spec-merkle-commit.md`). | The bridge is a long-lived architectural dependency and should not be buried in dated notes; Paper II tick receipts are required for deterministic debugging and provenance. Reusing `decision_digest` commits to accepted/rejected outcomes without changing the commit header shape. | A stable bridge doc is indexed in `docs/docs-index.md`; tools/tests can obtain receipts from `commit_with_receipt`. Commit ids now incorporate receipt outcomes whenever the candidate set is non-empty (empty receipts still use the canonical empty digest). |
| 2025-12-28 | Brand asset variants | Add `assets/echo-white-radial.svg`: an `echo-white.svg`-derived logo variant with a shared radial gradient fill (`#F5E6AD` center ‚Üí `#F13C77` edges) and an interior stroke emulated via clipped stroke paths for broad SVG renderer support. | Provide a ready-to-use, style-forward logo asset while keeping the original `echo-white.svg` unchanged; prefer a clip-path ‚Äúinner stroke‚Äù technique over `stroke-alignment` to avoid uneven renderer support. | Consumers can pick the original flat-white logo or the gradient+inner-stroke variant without changing code; the new SVG renders consistently in common SVG engines (rsvg/InkScape). |
| 2025-12-28 | Repo tour + onboarding refresh | Replace the root README with a reality-aligned overview, link Echo to the AIŒ©N Framework + the Foundations series papers, and add durable tour/bridge notes; fix `spec-merkle-commit` empty-digest semantics to match `warp-core`. | Keep onboarding and determinism specs consistent with the implemented engine contracts and the motivating research lineage; reduce future churn caused by doc drift. | New `README.md`, `docs/notes/project-tour-2025-12-28.md`, and `docs/notes/aion-papers-bridge.md` provide a single entry path; the commit digest spec now matches code behavior. |
| 2025-12-28 | WARP alignment (rename) | Mechanically rename legacy RMG identifiers to WARP equivalents across the workspace (crates, types, protocol, docs): `rmg-*` ‚Üí `warp-*`, `Rmg*` ‚Üí `Warp*`, and update the book/specs accordingly; keep wire decode aliases for legacy `subscribe_rmg`/`rmg_stream` and `rmg_id` during transition. | Align the repo with the AIŒ©N Foundations Series terminology so paper readers can map concepts directly; reduce long-term ‚Äútwo vocabularies‚Äù drift while keeping a short compatibility window. | Workspace compiles + tests pass under WARP naming; docs now speak WARP-first; legacy clients/notes can still decode via explicit compatibility aliases. |
| 2025-12-28 | PR #141 follow-up (new CodeRabbit nits @ `4469b9e`) | Add `[workspace.package]` metadata and migrate `spec-000-rewrite` to inherit `license`, `repository`, and `rust-version`; update the rust-version guard to accept `rust-version.workspace = true` and avoid `sed` for output formatting. | Reduce duplication/drift across manifests and keep the guard compatible with Cargo workspace inheritance while staying bash-idiomatic. | Spec-000 rewrite no longer duplicates common package metadata (`e4e5c19`); the rust-version guard is more robust + test-backed (`7e84b16`). |
| 2025-12-28 | PR #141 follow-up (new CodeRabbit review @ `639235b`) | Re-affirm `"wasm"` as a valid crates.io category (verify via API) and restore it on WASM crates for discoverability; fix Spec-000 doc examples so they‚Äôre internally consistent (serializable `WarpGraph`, non-noop `Disconnect`); tighten CI guard semantics and harden the rust-version checker script with recursion + self-tests. | Avoid churn from contradictory review assertions by checking the source-of-truth; keep spec examples honest/compilable; ensure CI guards are robust and self-documenting. | WASM crates regain the canonical category (`84e63d3`); Spec-000 docs examples compile/behave as claimed (`922553f`); echo-session-client uses workspace deps (`dfa938a`); rust-version guard is future-proof + tested and `cargo-audit` self-tests live with dependency policy (`56a37f8`). |
| 2025-12-28 | PR #141 follow-up (new CodeRabbit review @ `b563359`) | Standardize the workspace MSRV to match the pinned toolchain (Rust 1.90.0) and enforce it via CI; de-duplicate security audit ignores by sourcing them from `deny.toml`; remove stale advisory ignores and simplify publish metadata to reduce churn. | Prevent ‚Äúworks on my toolchain‚Äù drift, keep policy single-sourced, and avoid future review loops caused by duplicated ignore lists or stale configuration. | CI now guards rust-version consistency; `scripts/run_cargo_audit.sh` can‚Äôt drift from `deny.toml`; publishing metadata avoids disputed categories; follow-ups landed in `0f8e95d`, `150415b`, `2ee0a07`, `3570069`, `3e5b52d`, `3ccaf47`, `1bf90d3`, `8db8ac6`, `82fce3f`, and `e5954e4`. |
| 2025-12-28 | PR #141 follow-up (SPDX + deny housekeeping) | Align SPDX enforcement with the repo license split by treating build/config files as code (Apache-2.0) and repairing headers accordingly; document required cargo-deny allowlist licenses (OpenSSL, Ubuntu-font-1.0) with explicit dependency justification; move warp-viewer local crate pins into `[workspace.dependencies]` for DRY version management. | Reduce licensing ambiguity and prevent drift between file headers and crate metadata; keep deny policy explicit and justified; centralize path+version pins to avoid repeated edits across crates. | SPDX CI now enforces the intended split; cargo-deny license policy remains green and understandable; viewer crate updates become a single root bump. Fixes in `042ec2b`, `5086881`, and `17687f2`. |
| 2025-12-28 | PR #141 follow-up (new CodeRabbit review @ `c8111ec`) | Harden CI and docs hygiene: pin `cargo-deny` GitHub Action to a verified commit SHA; remove duplicate `cargo-audit` job from `ci.yml` and centralize audit args in `scripts/run_cargo_audit.sh`; harden the task-list guard by making it case-insensitive, failing when no task lists exist, and adding self-tests. | Keep CI supply-chain deterministic and reduce drift; make task-list enforcement reliable (and test-backed) so docs can‚Äôt silently contradict themselves. | CI logs become clearer and more deterministic; task-list guard now detects case-only near-duplicates and has regression tests; security audit policy is single-sourced. Fixes in `602ba1e` (plus doc cleanup commit in this follow-up). |
| 2025-12-28 | PR #141 follow-up (new CodeRabbit round) | Fix Spec-000 rewrite history semantics by adding `Rewrite.subject` (field name) and storing actual prior field values in `old_value` for `Set`; bump Spec-000 Leptos dependency to `0.8.15` and adjust the CSR scaffold to match the new API. | Align docs and implementation so rewrite history supports replay/undo semantics; keep the living spec scaffold on maintained Leptos/WASM patch releases. | New regression test locks the semantics; Spec-000 builds on Leptos 0.8.15; fixes land in `1f36f77` and `1a0c870`. |
| 2025-12-28 | PR #141 follow-up (new review batch + CI repairs) | Address CodeRabbit‚Äôs follow-up round: extract constants, strengthen tests (including negative framing cases), tighten WASM ABI/bindings docs and no-op semantics, and add automated task list consistency checks (pre-commit + CI). Repair CI policy failures by allowing required transitive licenses (OpenSSL, Ubuntu-font) and version-pinning workspace path deps to satisfy cargo-deny wildcard bans; ignore RUSTSEC-2024-0370 until upstream replaces `proc-macro-error`. | Keep boundaries deterministic and panic-free while preventing regression churn; ensure CI remains a reliable gate even when upstream marks dependencies as ‚Äúunmaintained‚Äù without a drop-in replacement. | Follow-up review comments map cleanly to fixing SHAs; `cargo test`/clippy gates stay green; CI audit/deny jobs pass and task lists can‚Äôt drift into contradictory ‚Äúchecked + unchecked‚Äù duplicates. |
| 2025-12-28 | PR #141 CodeRabbit burn-down (Spec-000 scaffold) | Resolve all actionable PR review items: align living-spec methodology/tasks docs with current repo reality; add tests for session-client error scoping; harden WS gateway framing/teardown and upgrade to axum 0.8; declare MSRV for edition-2024 WASM crates. | Prevent review churn and regressions by moving expectations into tests/docs; ensure the WS gateway fails fast and is debuggable; make toolchain requirements explicit for 2024-edition crates. | Workspace is green (`cargo test`, clippy w/ `-D missing_docs`); review comments can be cleared with referenced SHAs; living-spec docs now distinguish implemented scaffolding from planned certification. |
| 2025-12-13 | WS gateway lifecycle + Spec-000 WASM | Gate Spec-000‚Äôs `wasm_bindgen` entrypoint behind `cfg(all(feature = "wasm", target_arch = "wasm32"))`; on the WS gateway, treat upstream (UDS) disconnect as terminal by sending a best-effort Close frame and cancelling the ping loop + sibling tasks. | Keeps default host builds green while still supporting Trunk/wasm32; prevents hanging `join!`/leaked ping tasks that keep browser connections alive when the backend is gone. | Workspace builds no longer trip wasm-only entrypoints; browser clients get a clean disconnect on upstream failure instead of a zombie connection receiving only pings. |
| 2025-12-11 | Browser WS gateway | Added `echo-session-ws-gateway`: axum-based WebSocket‚ÜíUnix bridge with optional rustls TLS, origin allowlist, 8‚ÄØMiB frame guard, and JS-ABI frame parsing to keep gapless WARP framing intact for browser clients. | Browsers need WS; TCP proxies can‚Äôt handle WS framing. A thin Rust gateway keeps protocol identical while enforcing size/origin limits and retaining Unix-socket hub. | Browser clients can subscribe/publish WARP streams over WS; no protocol change to hub; TLS/origin filters available for internet exposure. |
| 2025-12-11 | Scripting runtime pivot | Replace the prior scripting embedding with Rhai as the deterministic scripting layer; update docs/roadmaps/backlogs accordingly. warp-ffi stays for host/native integrations; scripting embeds Rhai directly. | Rhai runs in-process, is Rust-native, and gives tighter control over deterministic sandboxes without C FFI complexity; aligns with deterministic host modules and reduces attack surface. | All design documents, plans, and demo targets now refer to Rhai; future scripting work focuses on Rhai modules and hot-reload, not legacy bindings. |
| 2025-12-11 | WARP authority enforcement | Session-service now pins a single producer per WarpId, rejects other publishers with structured errors (`E_FORBIDDEN_PUBLISH`, `E_WARP_SNAPSHOT_REQUIRED`, `E_WARP_EPOCH_GAP`), and preserves snapshot/diff gap checks; session-client surfaces Error frames as local error notifications. | Prevents competing writers from corrupting WARP streams and makes protocol violations visible to tools instead of silent drops or disconnects. | Unauthorized publishes fail fast without fanout; clients see explicit error notifications; sets the stage for dirty-loop/resync work. |
| 2025-12-10 | CI cargo-audit warnings | Keep `cargo audit --deny warnings` green by ignoring RUSTSEC-2024-0436 (paste unmaintained via wgpu/metal) and RUSTSEC-2021-0127 (serde_cbor legacy advisory) in both `security-audit.yml` and `ci.yml`. | Paste is an unmaintained transitive dep of wgpu with no downstream replacement yet; serde_cbor was removed from the codebase but may reappear through cached lockfiles‚Äîignoring prevents CI flakiness while we track upstream updates. | Security audit jobs now ignore these advisories in both workflows; advisories remain documented and will surface again once upstreams ship replacements or if serde_cbor re-enters the tree. |
| 2025-12-10 | CI cargo-deny index warnings | Prime crates.io index with `cargo fetch --locked` in the `deny` job before running `cargo-deny` (ci.yml). | `cargo deny` was emitting `warning[index-failure]` when it tried to query yanked status without a local index; warming the index prevents network flakiness from spamming logs and fails early if fetch cannot reach crates.io. | CI is quieter and deterministically fails on real connectivity issues; yank checks now use the warmed cache instead of best-effort network lookups during the deny step. |
| 2025-12-10 | WARP View Protocol plan | Added `docs/tasks.md` with a checklist to deliver the WARP View Protocol (pub/sub authority, dirty-loop publishing, demo path, tests) and logged intent in execution-plan. | Centralizes the work needed to demo multi-viewer shared WARPs and sets commit-by-slice expectations. | Provides a single progress list; future slices will check off items and keep docs aligned. |
| 2025-12-10 | CBOR migration + viewer gating | Replaced archived `serde_cbor` with `ciborium` in proto/graph (canonical encoder/decoder with serde_value bridge), marked graph enums `#[non_exhaustive]`, made canonical hashing return `Result`, and aligned egui deps/input handling (pointer & WASDQE gated to View, escape only on keydown, snapshot hash mismatch desyncs). | Keeps wire format on a maintained crate, avoids namespace pollution, and prevents silent desyncs or UI mutation outside the View screen; removes raw pointer aliasing in app_events. | Canonical framing stays deterministic on supported MSRV, oversized ints surface errors, viewer input is safer/debuggable, and CI dependency alignment avoids egui patch skew. |
| 2025-12-10 | Viewer timing + session buffering | Capture frame `dt` once per frame and reuse for camera/layout/arcball; compute angular velocity using `angle/dt` with epsilon and zero-angle guard; session client now buffers header/payload/checksum across reads, decodes only when a full packet is present, and never drops partial data. | Prior code reset `last_frame` before `elapsed()` uses, producing zero dt and runaway angular velocities; arcball used a bogus constant divisor; poll_message dropped partial headers and over-allocated payloads. | Viewer motion/decay uses correct per-frame delta and stable spin; angular velocity matches actual drag speed; session client keeps stream in sync and surfaces `Ok(None)` only when truly no data. |
| 2025-12-10 | Config + docs alignment | README points to `ConfigStore` and correct doc path; proto reexports are explicit with serde-renamed `AckStatus::{Ok,Error}`; constellation figure labeled/cross-referenced with anchored legend. | Aligns docs with actual APIs and keeps figure references stable. | Less namespace pollution, accurate docs, and reliable LaTeX figure placement. |
| 2025-12-10 | Session client framing/polling | poll_message is now non-blocking, buffered across calls, enforces an 8‚ÄØMiB max payload with checked arithmetic, and respects header+payload+checksum sizing; poll_notifications drains buffered notifications only. Added partial-header test earlier. | Previous blocking loop could spin forever and trust unbounded lengths; partial reads risked desync and OOM. | Session client won‚Äôt block while idle, rejects oversized frames safely, and keeps framing consistent across partial reads. |
| 2025-12-10 | Viewer timing & safety | Frame dt captured once and reused for motion/decay; angular velocity uses angle/dt with epsilon; viewport access no longer unwraps; helper window lifetimes relaxed; single aspect computation. | Prevents zero-dt spins, stabilizes arcball momentum, and avoids panics when no viewport exists. | Viewer motion is stable and safe even if viewports haven‚Äôt been created yet. |
| 2025-12-06 | Tool crate docs | Added a crate map for tool-related crates in the Echo Tools booklet and gave each tool crate (echo-app-core, echo-config-fs, echo-session-proto, echo-session-service, echo-session-client, warp-viewer) a local README with a ‚ÄúWhat this crate does‚Äù + ‚ÄúDocumentation‚Äù section pointing back to the booklets/ADR/ARCH specs. | Keeps the booklets as the canonical source of truth while giving each crate a concise, local summary of its role and where to find the full design docs. | New contributors can navigate from any tool crate directly to the relevant sections of the Echo book and ADR/ARCH documents; Cargo `readme` fields now point at crate-local READMEs instead of the repo root. |
| 2025-12-06 | JS-ABI + WARP docs | Aligned Echo‚Äôs LaTeX booklets with JS-ABI v1.0 (deterministic encoding + framing) and the new WARP streaming stack by adding Core sections for the wire protocol and generic WARP consumer contract, plus cross-links from Session Service and WARP Viewer. | Keeps the implementation (canonical CBOR encoder, packet framing, gapless WARP streams) in lockstep with durable docs; avoids re-specifying the same contract in multiple places. | Core booklet now explains JS-ABI framing and the per-WarpId snapshot/diff consumer algorithm (with a role summary table); Tools booklet‚Äôs Session Service and WARP Viewer sections link back to that contract instead of drifting copies. |
| 2025-12-04 | WARP streaming stack | Landed shared `echo-graph` crate (canonical RenderGraph + `WarpFrame`/`WarpOp`/Snapshot/Diff) and rewired proto/viewer to use gapless structural diffs with hash checks. | Avoids viewer-owned graph types and keeps the wire contract deterministic; lets tools share one graph representation. | Viewer now enforces no-gap epoch sequence and hashes when applying diffs; remaining work is engine emitter + extracting IO into adapters. |
| 2025-12-04 | Session hub IO | Moved socket/CBOR IO into `echo-session-client` helpers and wired `warp-viewer` to consume frames/notifications from the client; session service now emits snapshot + gapless diffs (stub engine). | Restores hex boundaries: viewer is render-only; hub owns transport; provides a live gapless WARP stream for development. | Roadmap P1 items for client wiring and engine emitter are checked; next up: real engine integration and better scene mapping from payloads. |
| 2025-12-03 | `warp-viewer/ROADMAP` | Marked all P0 items as completed after code review (arrow offsets, HUD VSync toggle, controls overlay, watermark, MSAA). | Features are implemented in `src/main.rs` and shaders (VSync toggle, help overlay, watermark image, arrowhead offset via `head`, MSAA sample_count=4). | Roadmap now reflects shipped P0 scope; next focus shifts to P1 items (persistence, perf overlay, tunable arrowheads, camera auto-fit). |
| 2025-12-03 | `warp-viewer` config | Added JSON config persisted under OS config dir; camera pose + HUD toggles + vsync/watermark now survive restarts. | Serialize viewer state with serde; load on startup, save on close; uses `directories` for platform paths. | Roadmap P1 ‚Äúpersist camera + HUD debug settings‚Äù checked off; future sessions start with last-used view. |
| 2025-12-03 | `warp-viewer` roadmap | Reprioritized viewer roadmap around hexagonal boundaries: core/services hold session/config/toasts; viewer becomes a rendering adapter; editor service is a separate adapter. | Avoids ‚Äútiny editor‚Äù creep in viewer; aligns upcoming work to extract core (`echo-app-core`, config/toast services), add session service/client, then resume UX/perf polish. | Roadmap now sequences architecture first, then service/client, then UX/visual layers. |
| 2025-12-03 | `echo-app-core` + `echo-config-fs` | Added core app crate (ConfigService/ToastService/ViewerPrefs) and filesystem ConfigStore adapter; warp-viewer now loads/saves prefs via the new services (no serde/directories in viewer). | Reclaims hex boundaries: persistence + prefs live in shared core/adapters; viewer stays render-focused and emits prefs on exit. | Roadmap P0 items for core + fs adapter + viewer refactor are checked off; toast rendering still pending. |
| 2025-12-03 | `warp-viewer` HUD toasts | Wired viewer HUD to render toasts supplied by core ToastService; config save/load errors surface as toasts. | Keeps viewer dumb: rendering only; toast lifecycle lives in core; colors/progress bar show TTL. | P0 toast renderer item done; next up: session service/client slice. |
| 2025-12-04 | Session proto/service/client skeleton | Added crates `echo-session-proto`, `echo-session-service` (stub hub), and `echo-session-client` (stub API) to prep distributed session architecture. | Establishes shared wire schema (Handshake, SubscribeWarp, WarpStream (snapshot/diff), Notification) and stub entrypoints; transport to be added next. | Roadmap P1 proto/service/client items checked (skeleton); viewer still needs to bind to client. |
| 2025-11-29 | LICENSE | Add SPDX headers to all files | LEGAL PROTECTION üõ°Ô∏è‚ú® |
| 2025-11-30 | `F32Scalar` | Canonicalize subnormal values to zero | Now, they're zero. |
| 2025-12-01 | Docs LaTeX skeleton | Added shared preamble/title/legal pages, parts + per-shelf booklet drivers, logo PDFs; seeded onboarding roadmap and glossary chapters. | Enable one master PDF and four shelf booklets with consistent legal/branding; Orientation now has a guided entry path. | Makefile builds master + booklets; future content/diagrams can slot into parts without restructuring. |
| 2025-12-01 | `package.json` package manager | Set `packageManager` to `pnpm@10.23.0`. | Aligns repo tooling with pnpm lockfile and preferred workflow; avoids accidental npm/yarn installs. | Editors and CI will default to pnpm; prevents mismatched lockfiles or node_modules layout. |
| 2025-12-01 | `Cargo.toml` bench profile | Remove `panic = "abort"` from `[profile.bench]`. | Silence cargo warning as this setting is ignored for bench profiles; rely on release profile inheritance or default behavior. | Cleaner build output; no behavior change for benches (which default to unwind or abort based on target/inheritance). |
| 2025-11-30 | `F32Scalar` NaN reflexivity | Update `PartialEq` implementation to use `total_cmp` (via `Ord`) instead of `f32::eq`. | Ensures `Eq` reflexivity holds even for NaN (`NaN == NaN`), consistent with `Ord`. Prevents violations of the `Eq` contract in collections. | `F32Scalar` now behaves as a totally ordered type; NaN values are considered equal to themselves and comparable. |
| 2025-11-30 | `F32Scalar` NaN canonicalization | Canonicalize all NaNs to `0x7fc00000` in `F32Scalar::new`. Update MSRV to 1.83.0 for `const` `is_nan`/`from_bits`. | Guarantees bit-level determinism for all float values including error states. Unifies representation across platforms. MSRV bump enables safe, readable `const` implementation. | All NaNs are now bitwise identical; `const fn` constructors remain available; `warp-core` requires Rust 1.83.0+. |
| 2025-11-30 | `F32Scalar` canonicalization | Enforce bitwise determinism by canonicalizing `-0.0` to `+0.0` for all `F32Scalar` instances; implement `PartialEq`, `Eq`, `PartialOrd`, `Ord`, `Display`. Make `value` field private. | Essential for bit-perfect cross-platform determinism in math operations and comparisons, especially for hashing and serialization. Prevents accidental introduction of `-0.0` by direct field access. | Guarantees consistent numerical behavior for `F32Scalar`; all public API methods and constructors now ensure canonical zero. |
| 2025-11-29 | `F32Scalar` | Add `warp-core::math::scalar::F32Scalar` type | Now we have it. |
| 2025-11-03 | Scalar foundation | Add `warp-core::math::Scalar` trait (operator supertraits + sin/cos) | Arithmetic via `Add/Sub/Mul/Div/Neg` supertraits for ergonomic `+ - * /`; `sin/cos` methods declared; canonicalization/LUTs deferred | Unblocks F32Scalar and DFix64 implementations; math code can target a stable trait |
| 2025-10-23 | Repo reset | Adopt pnpm + TS skeleton | Monorepo scaffolding for Echo | Phase 0 tasks established |
| 2025-10-24 | Branch tree spec | Integrate roaring bitmaps and chunk epochs | Deterministic merges & diffs | Snapshot policy updated |
| 2025-10-24 | Codex‚Äôs Baby spec | Event envelopes, temporal bridge integration | Align with causality layer | Security envelopes + inspector updates |
| 2025-10-25 | Serialization protocol | Canonical encoding using BLAKE3 | Cross-platform determinism | Replay tooling groundwork |
| 2025-10-25 | Temporal bridge doc | Formalized retro delivery & paradox guard | Ensure cross-branch consistency | Entropy hooks refined |
| 2025-10-25 | Replay plan | Golden hashes + CLI contract | Ensure reproducibility | Phase 1 test suite scope |
| 2025-10-25 | Math validation harness | Landed Rust fixture suite & tolerance checks for deterministic math | Keep scalar/vector/matrix/quaternion results stable across environments | Extend coverage to browser + fixed-point modes |
| 2025-10-26 | EPI bundle | Adopt entropy, plugin, inspector, runtime config specs (Phase 0.75) | Close causality & extensibility gap | Phase 1 implementation backlog defined |
| 2025-10-26 | WARP + Confluence | Adopt WARP v2 (typed DPOi engine) and Confluence synchronization as core architecture | Unify runtime/persistence/tooling on deterministic rewrites | Launch Rust workspace (warp-core/ffi/wasm/cli), port ECS rules, set up Confluence networking |
| 2025-10-27 | Core math split | Split `warp-core` math into focused submodules (`vec3`, `mat4`, `quat`, `prng`) replacing monolithic `math.rs`. | Improves readability, testability, and aligns with strict linting. | Update imports; no behavior changes intended; follow-up determinism docs in snapshot hashing. |
| 2025-10-27 | PR #7 prep | Extracted math + engine spike into `warp-core` (split-core-math-engine); added inline rustdoc on canonical snapshot hashing (node/edge order, payload encoding). | Land the isolated, reviewable portion now; keep larger geometry/broad‚Äëphase work split for follow-ups. | After docs update, run fmt/clippy/tests; merge is a fast‚Äëforward over `origin/main`. |

## Recent Decisions (2025-10-28 onward)

The following entries use a heading + bullets format for richer context.
| 2025-12-01 | `docs/guides/how-do-echo-work` PDF build | Escaped bare `&` tokens, fixed TikZ bidirectional arrows, added a minimal Rust listing language, and made the LaTeX Makefile run in non-interactive `-halt-on-error` mode (three passes). | Prevents TikZ parse failures and listings errors, avoids TeX prompting in CI/automation, and keeps code samples readable. | `make` in `docs/guides/how-do-echo-work` now produces `main.pdf` without interaction; remaining output is cosmetic overfull hbox warnings. |
| 2025-12-01 | `docs/guides/how-do-echo-work` accuracy + visuals | Synced guide content to current code: clarified scheduler kinds (Radix/Legacy), footprint conflicts, sandbox determinism helper, and `F32Scalar` behavior (canonical zero only; NaNs passthrough for now). Added timeline tree TikZ, resized hex diagram, refreshed comparison table, and Rust listings. Removed layout warnings. | Keep the guide truthful to warp-core as implemented; improves reader clarity and CI reliability. | `main.pdf` builds non-interactively; visuals/tables reflect actual APIs and invariants; remaining determinism work (LUT sin/cos, NaN canonicalization) is called out as future work. |
| 2025-12-01 | SPDX appendix + CI check | Added `legal-appendix.tex` with dual-license explainer and included it in the guide. Introduced `spdx-header-check.yml` workflow that runs `scripts/check_spdx.sh --check --all` to enforce SPDX headers. | Ensures licensing terms are visible in the book and keeps automated enforcement in CI. | New appendix renders in PDF; workflow will fail PRs missing SPDX headers. |
| 2025-11-06 | warp-core scheduler Clippy cleanup | Make pre-commit pass without `--no-verify`: fix `doc_markdown`, `similar_names`, `if_not_else`, `option_if_let_else`, `explicit_iter_loop`; change `RewriteThin.handle` to `usize`; keep radix `counts16` as `Vec<u32>` (low bandwidth) with safe prefix-sum/scatter; fail fast in drain with `unreachable!` instead of `expect()` or silent drop; make `pending` field private (keep `PendingTx` private). | Preserve determinism and ordering while satisfying strict `clippy::pedantic` and `-D warnings`. Avoid truncation casts and private interface exposure. | Determinism preserved; panic on invariant violation; histogram remains 256‚ÄØKiB on 64‚Äëbit; pre-commit unblocked.
| 2025-11-06 | warp-core test + benches lint fixes | Clean up `clippy::pedantic` failures blocking commit: (1) add backticks to doc comments for `b_in`/`b_out` and `GenSet(s)`; (2) refactor `DeterministicScheduler::reserve` into helpers to satisfy `too_many_lines`; (3) move inner test function `pack_port` above statements to satisfy `items_after_statements`; (4) remove `println!` and avoid `unwrap()`/`panic!` in tests; (5) use captured format args and `u64::from(...)`/`u32::from(...)` idioms; (6) fix `warp-benches/benches/reserve_scaling.rs` imports (drop unused `CompactRuleId` et al.) and silence placeholder warnings. | Align tests/benches with workspace lint policy while preserving behavior; ensure CI and pre-commit hooks pass uniformly. | Clippy clean on lib + tests; benches compile; commit hook no longer blocks.
| 2025-11-06 | CI fix | Expose `PortSet::iter()` (no behavior change) to satisfy scheduler iteration in CI. | Unblocks Clippy/build on GH; purely additive API. | CI gates resume.
| 2025-10-30 | warp-core determinism hardening | Added reachability-only snapshot hashing; closed tx lifecycle; duplicate rule detection; deterministic scheduler drain order; expanded motion payload docs; tests for duplicate rule name/id and no‚Äëop commit. | Locks determinism contract and surfaces API invariants; prepares PR #7 for a safe merge train. | Clippy clean for warp-core; workspace push withheld pending further feedback. |
| 2025-10-30 | Tests | Add golden motion fixtures (JSON) + minimal harness validating motion rule bytes/values | Establishes deterministic test baseline for motion; supports future benches and tooling | No runtime impact; PR-01 linked to umbrella and milestone |
| 2025-10-30 | Templates PR scope | Clean `echo/pr-templates-and-project` to contain only templates + docs notes; remove unrelated files pulled in by merge; fix YAML lint (trailing blanks; quote placeholder) | Keep PRs reviewable and single-purpose; satisfy CI Docs Guard | Easier review; no runtime impact |
| 2025-10-30 | Docs lint | Fix MD022 (blank line after headings) in `docs/spec-deterministic-math.md` on branch `echo/docs-math-harness-notes` | Keep markdown lint clean; improve readability | No content change; unblock future docs PRs |
| 2025-10-30 | Bug template triage | Add optional `stack_trace` and `version` fields to `.github/ISSUE_TEMPLATE/bug.yml` | Capture logs and version/SHA up front to speed debugging | Better triage signal without burdening reporters |
| 2025-10-30 | Bug template wording | Standardize bug template descriptions to imperative capitalization ("Provide ‚Ä¶") | Consistent style and clearer prompts | Improved reporter guidance |
| 2025-10-30 | Proptest seed pinning | Add dev‚Äëdep `proptest` and a pinned‚Äëseed property test for motion rule (`proptest_seed_pinning.rs`) | Establish deterministic, reproducible property tests and document seed‚Äëpinning pattern | Tests‚Äëonly; no runtime impact |
| 2025-10-30 | CI matrix | Add musl tests job (warp-core; x86_64-unknown-linux-musl) and a manual macOS workflow for local runs | Cover glibc + musl in CI while keeping macOS optional to control costs | Determinism coverage improves; CI footprint remains lean |
| 2025-10-30 | Motion negative tests (PR-06) | Add tests documenting NaN/Infinity propagation and invalid payload size NoMatch in motion rule | Clarify expected behavior without changing runtime; improves determinism docs via tests | Tests-only; no runtime impact |
| 2025-10-30 | BLAKE3 header tests (PR-09) | Add unit tests to verify commit header encoding order/endianness and hash equivalence | Codifies checklist guarantees in tests; prevents regressions | Tests-only; no runtime impact |
| 2025-10-30 | README CI tips (PR-10) | Document manual macOS workflow and how to reproduce CI locally | Lowers barriers to contributor validation | Docs-only |
| 2025-10-28 | PR #7 merged | Reachability-only snapshot hashing; ports demo registers rule; guarded ports footprint; scheduler `finalize_tx()` clears `pending`; `PortKey` u30 mask; hooks+CI hardened (toolchain pin, rustdoc fixes). | Determinism + memory hygiene; remove test footguns; pass CI with stable toolchain while keeping warp-core MSRV=1.68. | Queued follow-ups: #13 (Mat4 canonical zero + MulAssign), #14 (geom train), #15 (devcontainer). |
| 2025-10-27 | MWMR reserve gate | Engine calls `scheduler.finalize_tx()` at commit; compact rule id used on execute path; per‚Äëtx telemetry summary behind feature. | Enforce independence and clear active frontier deterministically; keep ordering stable with `(scope_hash, family_id)`. | Toolchain pinned to Rust 1.68; add design note for telemetry graph snapshot replay. |
 

## 2025-10-28 ‚Äî Mat4 canonical zero + MulAssign (PR #13)

- Decision: Normalize -0.0 from trig constructors in Mat4 and add MulAssign for in-place multiplication.
- Rationale: Avoid bitwise drift in snapshot/matrix comparisons across platforms; improve ergonomics in hot loops.
- Impact: No API breaks. New tests assert no -0.0 in rotation matrices at key angles; added `MulAssign` for owned/&rhs.
- Next: Review feedback; if accepted, apply same canonicalization policy to other math where applicable.
 
## 2025-10-28 ‚Äî Geometry merge train (PR #14)

- Decision: Use an integration branch to validate #8 (geom foundation) + #9 (broad-phase AABB) together.
- Rationale: Surface cross-PR interactions early and avoid rebase/force push; adhere to merge-only policy.
- Impact: New crate `warp-geom` (AABB, Transform, TemporalTransform) and baseline broad-phase with tests. No public API breaks in core.
- Next: If green, merge train PR; close individual PRs as merged-via-train.

## 2025-10-28 ‚Äî warp-geom foundation (PR #8) compile + clippy fixes

- Decision: Keep PR #8 scoped to geometry foundations; defer `broad` module to its own PR to avoid E0583.
- Changes: Use `Quat::to_mat4` + `Mat4::new` in `Transform::to_mat4`; replace `Vec3::ZERO` with `Vec3::new(0,0,0)` for MSRV; rename variables to satisfy `similar_names`.
- CI: Merged latest `main` to pick up stable-toolchain overrides for workspace clippy/test; crate-level clippy gates relaxed (drop `nursery`/`cargo`) to avoid workspace metadata lints.
- Next: Land PR #9 for broad-phase on top; revisit clippy gates once workspace has uniform metadata.
## 2025-10-28 ‚Äî Devcontainer added

- Decision: Provide a reproducible local environment matching CI runners.
- Details: VS Code devcontainer (Ubuntu 24.04) with Rust stable + MSRV toolchains, clippy/rustfmt, Node 20, gh CLI; post-create script installs 1.68.0 and wasm target.
- Outcome: Faster feedback loops; easier reproduction of CI issues (clippy, rustdoc, Docs Guard).

## 2025-10-28 ‚Äî Pre-commit formatting flag renamed

- Decision: Use an Echo-scoped env var for auto-format on commit.
- Change: `AUTO_FMT` ‚Üí `ECHO_AUTO_FMT` in `.githooks/pre-commit`.
- Docs: README, AGENTS, CONTRIBUTING updated with hook install and usage.

## 2025-10-29 ‚Äî Snapshot header v1 + tx/rule hardening (warp-core)

- Context: PR #9 base work on top of PR #8; integrate deterministic provenance into snapshots without changing reachable‚Äëonly state hashing.
- Decision: Model snapshots as commit headers with explicit `parents` and metadata digests (`plan`, `decision`, `rewrites`). Keep `decision_digest = blake3(len=0_u64)` (canonical empty list digest) until Aion/agency lands.
- Changes:
  - `Snapshot { parents: Vec<Hash>, plan_digest, decision_digest, rewrites_digest, policy_id }`.
  - `Engine::commit()` computes `state_root`, canonical empty/non‚Äëempty digests, and final commit hash.
  - `Engine::snapshot()` produces a header‚Äëshaped view with canonical empty digests so a no‚Äëop commit equals a pre‚Äëtx snapshot.
  - Enforce tx lifecycle (`live_txs` set; deny ops on closed/zero tx); `begin()` is `#[must_use]` and wraps on `u64::MAX` skipping zero.
  - Rule registration now rejects duplicate names and duplicate ids; assigns compact rule ids for execution hot path.
  - Scheduler is crate‚Äëprivate; ordering invariant documented (ascending `(scope_hash, rule_id)`).
- Tests: Added/updated motion tests (velocity preserved; commit after `NoMatch` is a no‚Äëop), math tests (relative tolerances; negative scalar multiplies; extra mul order).
- Consequence: Deterministic provenance is now explicit; future Aion inputs can populate `decision_digest` without reworking the header. No behavior changes for state hashing.

## 2025-10-29 ‚Äî Toolchain strategy: floor raised to 1.71.1

- Decision: Raise the workspace floor (MSRV) to Rust 1.71.1. All crates and CI jobs target 1.71.1.
- Implementation: Updated `rust-toolchain.toml` to 1.71.1; bumped `rust-version` in crate manifests; CI jobs pin 1.71.1; devcontainer installs only 1.71.1.

## 2025-10-29 ‚Äî Docs E2E carousel init (PR #10)

- Context: Playwright tour test clicks Next to enter carousel from "all" mode.
- Decision: Do not disable Prev/Next in "all" mode; allow navigation buttons to toggle into carousel.
- Change: docs/assets/collision/animate.js leaves Prev/Next enabled in 'all'; boundary disabling still applies in single-slide mode.
- Consequence: Users can initiate the carousel via navigation controls; E2E tour test passes deterministically.

## 2025-10-29 ‚Äî Docs make open (PR #11)

- Context: Make dev docs open automatically; fix routing and dead-link noise.
- Decisions:
  - Use a precise dead-link ignore for `/collision-dpo-tour.html` (exact regex) until the page is always present.
  - Convert tour/spec links to root‚Äërelative paths to work site‚Äëwide under VitePress routing.
  - Make the dev server polling loop portable (`sleep 1`).
- Consequence: Docs dev flow is consistent across environments; CI Docs Guard happy; links resolve from any page.

## 2025-10-29 ‚Äî Hooks formatting gate (PR #12)

- Context: Enforce consistent formatting before commit; avoid CI/docs drift when non-doc files change.
- Decision: Pre-commit runs `cargo fmt --all -- --check` whenever staged Rust files are detected. Retain the PRNG coupling guard but remove the unconditional early exit so formatting still runs when the PRNG file isn‚Äôt staged.
- EditorConfig: normalize line endings (LF), ensure final newline, trim trailing whitespace, set 2-space indent for JS/TS/JSON and 4-space for Rust.
- Consequence: Developers get immediate feedback on formatting; cleaner diffs and fewer CI round-trips.

## 2025-10-29 ‚Äî Geom fat AABB bounds mid-rotation

- Context: Broad-phase must not miss overlaps when a shape rotates about an off‚Äëcentre pivot; union of endpoint AABBs can under‚Äëapproximate mid‚Äëtick extents.
- Decision: `Timespan::fat_aabb` now unions AABBs at start, mid (t=0.5 via nlerp for rotation, lerp for translation/scale), and end. Sampling count is fixed (3) for determinism.
- Change: Implement midpoint sampling in `crates/warp-geom/src/temporal/timespan.rs`; add test `fat_aabb_covers_mid_rotation_with_offset` to ensure mid‚Äëpose is enclosed.
- Consequence: Deterministic and more conservative broad‚Äëphase bounds for typical rotation cases without introducing policy/config surface yet; future work may expose a configurable sampling policy.

## 2025-10-29 ‚Äî Pre-commit auto-format policy

- Decision: When `ECHO_AUTO_FMT=1` (default), the pre-commit hook first checks formatting. If changes are needed, it runs `cargo fmt` to update files, then aborts the commit. This preserves index integrity for partially staged files and prevents unintended staging of unrelated hunks.
- Rationale: `rustfmt` formats entire files; auto-restaging could silently defeat partial staging. Aborting makes the workflow explicit: review, restage, retry.
- Consequence: One extra commit attempt in cases where formatting is needed, but safer staging semantics and fewer surprises. Message includes guidance (`git add -p` or `git add -A`).

## 2025-10-29 ‚Äî CI + Security hardening

- Decision: Add `cargo audit` and `cargo-deny` to CI; expand rustdoc warnings gate to all public crates.
- Rationale: Catch vulnerable/deprecated crates and doc regressions early; keep public surface clean.
- Consequence: Faster failures on dependency or doc issues; small CI time increase.
- Notes:
  - Use `rustsec/audit-check@v1` for the audit step; avoid pinning to non-existent tags.
  - Add `deny.toml` with an explicit license allowlist to prevent false positives on permissive licenses (Apache-2.0, MIT, BSD-2/3, CC0-1.0, MIT-0, Unlicense, Unicode-3.0, BSL-1.0, Apache-2.0 WITH LLVM-exception).
  - Run cargo-audit on Rust 1.75.0 (via `RUSTUP_TOOLCHAIN=1.75.0`) to meet its MSRV; this does not change the workspace MSRV (1.71.1).

## 2025-10-29 ‚Äî Snapshot commit spec (v1)

- Decision: Introduce `docs/spec-merkle-commit.md` describing `state_root` vs `commit_id` encodings and invariants.
- Rationale: Make provenance explicit and discoverable; align code comments with a durable spec.
- Changes: Linked spec from `crates/warp-core/src/snapshot.rs` and README.
 
| 2025-10-30 | CI toolchain simplification | Standardize on Rust `@stable` across CI (fmt, clippy, tests, security audit); remove MSRV job; set `rust-toolchain.toml` to `stable`. | Reduce toolchain drift and recurring audit/MSRV mismatches. | Future MSRV tracking can move to release notes when needed. |
| 2025-10-30 | Rustdoc pedantic cleanup | Snapshot docs clarify `state_root` with code formatting to satisfy `clippy::doc_markdown`. | Keep strict lint gates green; no behavior change. | None. |
| 2025-10-30 | Spec + lint hygiene | Removed duplicate `clippy::module_name_repetitions` allow in `warp-core/src/lib.rs`. Clarified `docs/spec-merkle-commit.md`: `edge_count` is u64 LE and may be 0; genesis commits have length=0 parents; ‚Äúempty digest‚Äù explicitly defined as `blake3(b"")`; v1 mandates empty `decision_digest` until Aion lands. | Codifies intent; prevents ambiguity for implementers. | No code behavior changes; spec is clearer. |
| 2025-10-30 | Templates & Project | Added issue/PR/RFC templates and configured Echo Project (Status: Blocked/Ready/Done); fixed YAML lint nits | Streamlines review process and Kanban tracking | No runtime impact; CI docs guard satisfied |

## 2025-11-02 ‚Äî M1: benches crate skeleton (PR-11)

- Decision: Add `crates/warp-benches` with a minimal Criterion harness and a motion-throughput benchmark using public `warp-core` APIs.
- Rationale: Establish a place for performance microbenches; keep PR small and focused before adding JSON artifacts/regression gates in follow-ups.
- Consequence: Benches run locally via `cargo bench -p warp-benches`; no runtime changes.

## 2025-11-01 ‚Äî PR-10 scope hygiene (tests split)

- Context: PR‚Äë10 (README/CI/docs) accidentally included commit header tests in `snapshot.rs`, overlapping with PR‚Äë09 (tests‚Äëonly).
- Decision: Remove the test module from PR‚Äë10 to keep it strictly docs/CI/tooling; keep all BLAKE3 commit header tests in PR‚Äë09 (`echo/pr-09-blake3-header-tests`).
- Consequence: Clear PR boundaries; no runtime behavior change in PR‚Äë10.


## 2025-11-02 ‚Äî CI hotfix: cargo-deny (benches)

- Context: CI `cargo-deny` job failed on PR-11 due to `warp-benches` lacking a license and a prior wildcard dependency reference reported by CI logs.
- Decision: Add `license = "Apache-2.0"` to `crates/warp-benches/Cargo.toml` and ensure `warp-core` is referenced via a path dev-dependency (no wildcard).
- Rationale: Keep workspace policy consistent with other crates (Apache-2.0) and satisfy bans (wildcards = deny) and licenses checks.
- Consequence: `cargo-deny` bans/licenses should pass; remaining warnings are deprecations in `deny.toml` to be addressed in a later sweep.

## 2025-11-02 ‚Äî cargo-deny modernization

- Context: CI emitted deprecation warnings for `copyleft` and `unlicensed` keys in `deny.toml` (cargo-deny PR #611).
- Decision: Remove deprecated keys; rely on the explicit permissive `allow = [...]` list to exclude copyleft licenses; ensure all workspace crates declare a license (benches fixed earlier).
- Rationale: Keep CI quiet and align with current cargo-deny schema without weakening enforcement.
- Consequence: Same effective policy, no deprecation warnings; future license exceptions remain possible via standard cargo-deny mechanisms.
- CI Note: Use `cargo-deny >= 0.14.21` in CI (workflow/container) to avoid schema drift and deprecation surprises. Pin the action/image or the downloaded binary version accordingly.

## 2025-11-02 ‚Äî PR-12: benches pin + micro-optimizations

- Context: CI cargo-deny flagged wildcard policy and benches had minor inefficiencies.
- Decision:
  - Pin `blake3` in `crates/warp-benches/Cargo.toml` to exact patch `=1.8.2` and
    disable default features (`default-features = false, features = ["std"]`) to
    avoid rayon/parallelism in microbenches.
  - `snapshot_hash`: compute `link` type id once; label edges as `e-i-(i+1)` (no `e-0-0`).
  - `scheduler_drain`: builder returns `Vec<NodeId>`; `apply` loop uses precomputed ids to avoid re-hashing.
- Rationale: Enforce deterministic, single-threaded hashing in benches and satisfy
  cargo-deny wildcard bans; reduce noise from dependency updates.
- Consequence: Cleaner dependency audit and slightly leaner bench setup without
  affecting runtime code.

## 2025-11-02 ‚Äî PR-12: benches constants + documentation

- Context: Pedantic review flagged magic strings, ambiguous labels, and unclear throughput semantics in benches.
- Decision: Extract constants for ids/types; clarify edge ids as `<from>-to-<to>`; switch `snapshot_hash` to `iter_batched`; add module-level docs and comments on throughput and BatchSize; retain blake3 exact patch pin `=1.8.2` with trimmed features to stay consistent with CI policy.
- Rationale: Improve maintainability and readability while keeping dependency policy coherent and deterministic.
- Consequence: Benches read as executable docs; CI docs guard updated accordingly.

## 2025-11-02 ‚Äî PR-12: benches README + main link

- Context: Missing documentation for how to run/interpret Criterion benches.
- Decision: Add `crates/warp-benches/benches/README.md` and link from the top-level `README.md`.
- Rationale: Improve discoverability and ensure new contributors can reproduce measurements.
- Consequence: Docs Guard satisfied; single-source guidance for bench usage and outputs.

## 2025-11-02 ‚Äî PR-12: Sync with main + merge conflict resolution

- Context: GitHub continued to show a merge conflict on PR #113 (`echo/pr-12-snapshot-bench`).
- Decision: Merge `origin/main` into the branch (merge commit; no rebase) and resolve the conflict in `crates/warp-benches/Cargo.toml`.
- Resolution kept:
  - `license = "Apache-2.0"`, `blake3 = { version = "=1.8.2", default-features = false, features = ["std"] }` in dev-dependencies.
  - `warp-core = { version = "0.1.0", path = "../warp-core" }` (version-pinned path dep per cargo-deny bans).
  - Bench targets: `motion_throughput`, `snapshot_hash`, `scheduler_drain`.
- Rationale: Preserve history with a merge, align benches metadata with workspace policy, and clear PR conflict status.
- Consequence: Branch synced with `main`; local hooks (fmt, clippy, tests, rustdoc) passed; CI Docs Guard satisfied via this log and execution-plan update.

## 2025-11-02 ‚Äî Benches DX: offline report + server reliability

- Context: `make bench-report` started a background HTTP server that sometimes exited immediately; opening the dashboard via `file://` failed because the page fetched JSON from `target/criterion` which browsers block over `file://`.
- Decision:
  - Add `nohup` to the `bench-report` server spawn and provide `bench-status`/`bench-stop` make targets.
  - Add `scripts/bench_bake.py` and `make bench-bake` to generate `docs/benchmarks/report-inline.html` with Criterion results injected as `window.__CRITERION_DATA__`.
  - Teach `docs/benchmarks/index.html` to prefer inline data when present, skipping network fetches.
- Rationale: Remove friction for local perf reviews and allow sharing a single HTML artifact with no server.
- Consequence: Two paths now exist‚Äîlive server dashboard and an offline baked report. Documentation updated in main README and benches README. `bench-report` now waits for server readiness and supports `BENCH_PORT`.
## 2025-11-30 ‚Äî PR #121 CodeRabbit batch fixes (scheduler/bench/misc)

- Context: Address first review batch for `perf/scheduler` (PR #121) covering radix drain, benches, and tooling hygiene.
- Decisions:
  - Removed placeholder `crates/warp-benches/benches/reserve_scaling.rs` (never ran meaningful work; duplicated hash helper).
  - Added `PortSet::keys()` and switched scheduler boundary-port conflict/mark loops to use it, clarifying traversal API.
  - Bumped `rustc-hash` to `2.1.1` for latest fixes/perf; updated `Cargo.lock`.
  - Relaxed benches `blake3` pin to `~1.8.2` with explicit rationale to allow patch security fixes while keeping rayon disabled.
  - Cleaned bench dashboards: removed dead `fileBanner` script blocks, fixed fetch fallback logic, and added vendor/.gitignore guard.
  - Hardened `warp-math/build.sh` with bash shebang and `set -euo pipefail`.
- Rationale: Clean CI noise, make API usage explicit for ports, keep hashing dep current, and ensure math build fails fast.
- Consequence: Bench suite sheds a no-op target; scheduler code compiles against explicit port iteration; dependency audit reflects new rustc-hash and bench pin policy; dashboard JS is consistent; math build is safer. Docs guard satisfied via this log and execution-plan update.

## 2025-12-01 ‚Äî PR #121 follow-ups (portability, collision bench stub, doc clarifications)

- Context: Second batch of CodeRabbit feedback for scheduler/bench docs.
- Decisions:
  - Makefile: portable opener detection (open/xdg-open/powershell) for `bench-open`/`bench-report`.
  - Added `scheduler_adversarial` Criterion bench exercising FxHashMap under forced collisions vs random keys; added `rustc-hash` to benches dev-deps.
  - Introduced pluggable scheduler selection (`SchedulerKind`: Radix vs Legacy) with Radix default; Legacy path retains BTreeMap drain + Vec<Footprint> independence for apples-to-apples comparisons.
  - Added sandbox helpers (`EchoConfig`, `build_engine`, `run_pair_determinism`) for spinning up isolated Echo instances and per-step Radix vs Legacy determinism checks.
  - Documentation clarifications: collision-risk assumption and follow-up note in `docs/scheduler-reserve-complexity.md`; softened reserve validation claims and merge gating for the ‚Äú10‚Äì100x‚Äù claim in `docs/scheduler-reserve-validation.md`; fixed radix note fences and `RewriteThin.handle` doc to `usize`.
  - warp-math: documented \DPO macro parameters; fixed `warp-rulial-distance.tex` date to be deterministic.
  - scripts/bench_bake.py: executable bit, narrower exception handling, f-string output.
- Consequence: Bench portability and collision stress coverage improved; sandbox enables A/B determinism tests; docs no longer overclaim; LaTeX artifacts become reproducible. Remaining follow-ups: adversarial hasher evaluation, markdown lint sweep, IdSet/PortSet IntoIterator ergonomics.

## 2025-12-29 ‚Äî warp-core follow-ups: policy id plumbing + edge replay index (#151, #152)

- Context: Two ‚Äúminor‚Äù follow-ups were at risk of compounding into boundary drift:
  - Policy id was previously hardcoded/magic (`0u32`), even though commit header v2 and tick patch digests commit to `policy_id`.
  - Tick patch replay used an `O(total_edges)` scan (`remove_edge_by_id`) to migrate/remove edges by id.
- Decisions:
  - Make `policy_id` an explicit `Engine` configuration parameter, defaulting to `POLICY_ID_NO_POLICY_V0` (`b"NOP0"` as little‚Äëendian `u32`), and commit it consistently into `patch_digest` and `commit_id` v2.
  - Add a `GraphStore` reverse edge index (`EdgeId -> from NodeId`) and use it during tick patch replay so `UpsertEdge`/migration and `DeleteEdge` are `O(bucket_edges)` instead of scanning every bucket.
  - Maintain a store invariant that `edges_from` contains no empty buckets (prune buckets when the last edge is removed) so `state_root` remains a function of graph content, not mutation history.
- Rationale: Paper III boundary artifacts (delta patches) must stay replayable and scalable; committing to `policy_id` only makes sense if callers can set it explicitly; and replay must not devolve into quadratic behavior for large graphs.
- Consequence: Patch replay performance scales with local bucket size; policy semantics are explicit at the boundary; and identical graph states hash identically regardless of whether they were reached via add/remove edge sequences.

## 2025-12-29 ‚Äî warp-core Stage B0: two-plane attachments as typed atoms

- Context: Echo needed to align with the WARP papers‚Äô two-plane semantics (SkeletonGraph + attachment plane) without slowing rewrite matching/indexing.
- Decisions:
  - Define attachment payloads as typed, opaque atoms: `AtomPayload { type_id: TypeId, bytes: Bytes }`.
  - Keep node/edge records skeleton-only (`NodeRecord`, `EdgeRecord`); store attachment values separately in an attachment plane.
  - Introduce a strict codec boundary (`Codec<T>`, `DecodeError`, `CodecRegistry`) for rules/views/tooling; core matching/indexing does not decode.
  - Deterministic decode failure semantics (v0): type mismatch or strict decode failure ‚áí ‚Äúrule does not apply‚Äù.
  - Commit `type_id` into canonical encodings/digests (state_root and patch_digest) to prevent ‚Äúsame bytes, different meaning‚Äù collisions.
  - Lock the law: no hidden edges in payload bytes (dependencies must be skeleton-visible).
- Rationale: preserve determinism and performance while making attachment semantics explicit and safe.
- Consequence: payload typing becomes a first-class boundary artifact; the rewrite hot path remains skeleton-only; future recursion can be layered without reinterpreting bytes as structure.
  - Docs: `docs/spec/SPEC-0001-attachment-plane-v0-atoms.md` (spec) and `docs/warp-two-plane-law.md` (project law).

## 2025-12-30 ‚Äî warp-core Stage B1: WarpInstances + descended attachments (flattened indirection)

- Context: Depth-0 atoms alone are ‚ÄúWARP graphs of depth 0‚Äù; to model ‚ÄúWARPs all the way down‚Äù we needed explicit recursion without recursive hot-path traversal.
- Decisions:
  - Introduce instance-scoped identity (`WarpId`, `NodeKey`, `EdgeKey`) and multi-instance state (`WarpState`, `WarpInstance`).
  - Extend the attachment plane with explicit indirection: `AttachmentValue::Descend(WarpId)` (no encoding of structure inside bytes).
  - Make attachment slots first-class resources for causality:
    - `AttachmentKey` is a stable slot identity.
    - Footprints/scheduler treat attachment reads/writes as conflict resources.
    - Execution inside a descended instance must READ the descent-chain attachment keys.
  - Update the deterministic boundary:
    - `state_root` hashes reachable instance content across `Descend` links (skeleton + attachments + instance headers).
    - tick patch ops include instance metadata and attachment edits; patch digest encoding bumped to v2.
  - Add a minimal slice helper test validating that descendant work pulls in the portal producer (Paper III slice closure).
- Rationale: make recursion explicit, hashable, sliceable, and scheduler-visible while keeping matching/indexing skeleton-only within an instance.
- Consequence: Echo can represent recursive WARP state via flattened indirection; descended-instance rewriting stays fast and deterministic; slicing remains trivial over `in_slots`/`out_slots` without decoding atoms.
  - Docs: `docs/spec/SPEC-0002-descended-attachments-v1.md` (spec), `docs/spec-merkle-commit.md` (state_root reachability), and `docs/spec-warp-tick-patch.md` (patch digest v2 / portal ops).

## 2025-12-30 ‚Äî warp-core Stage B1.1: Atomic portals (OpenPortal) + merge/DAG slicing semantics

- Context: Stage B1 made descended attachments explicit, but portal authoring could still be expressed as multiple independent edits across ticks (create instance vs set `Descend`), which risks slices that include the portal write but omit the instance creation history.
- Decisions:
  - Add a single canonical tick patch operation for portal authoring: `WarpOp::OpenPortal { key, child_warp, child_root, init }`.
    - `OpenPortal` atomically establishes instance metadata and sets the `Descend(child_warp)` attachment slot.
    - Patch replay validates ‚Äúno dangling portal‚Äù and ‚Äúno orphan instance‚Äù invariants.
  - Bump `TickReceipt` digest format version to `2u16` after switching scope encoding to instance-scoped `NodeKey` so receipts remain self-describing across format evolution.
  - Update the patch diff constructor (`diff_state`) to emit `OpenPortal` for newly created descended instances when the `parent` slot is set to `Descend(child_warp)`, avoiding separate instance + attachment ops.
  - Specify multi-parent merge semantics explicitly:
    - merge commits must include an explicit merge patch that resolves all conflicting slot writes (including attachment slots); no implicit ‚Äúparent order wins‚Äù.
    - DAG slicing generalizes worldline slicing by treating merge patches as first-class resolution events.
  - Add a canonical terminology doc to pin ‚Äúinstances/portals vs wormholes‚Äù and prevent future term collisions.
- Rationale: Keep the Paper III replay boundary honest: the patch must be the boundary artifact, slices must not be able to omit required portal/instance creation history, and merges must be deterministically authored.
- Consequence: Portal authoring becomes clean and inevitable instead of a long-term swamp; tooling can build an honest instance-zoom view over explicit portals; merge/DAG slicing semantics are specified (implementation work remains).
  - Docs: `docs/spec/SPEC-0002-descended-attachments-v1.md` (merge commits + DAG slicing), `docs/architecture/TERMS_WARP_STATE_INSTANCES_PORTALS_WORMHOLES.md` (terminology lock), and `docs/branch-merge-playbook.md` (conflict resolution playbook).
  - Tests: `crates/warp-core/src/tick_patch.rs` (patch replay rejects dangling portals and orphan instances).

## 2025-12-30 ‚Äî THEORY.md: Foundations paraphrase + explicit divergence callouts

- Context: Echo‚Äôs implementation is driven by the published AIŒ©N Foundations papers, but Echo also makes pragmatic runtime trade-offs (performance, determinism boundaries, cross-language replay).
- Decisions:
  - Add `docs/THEORY.md` as a paraphrase/tour of Papers I‚ÄìIV (WARPs, deterministic ticks, tick patches/slicing, observer geometry).
  - Whenever Echo intentionally diverges from the paper definitions, add an inline callout in the form:
    - `> [!note]`
    - `> Echo does this differently. It works like X because Y.`
  - Commit the `assets/echo-white-radial.svg` brand asset and remove the local-only `assets/readme/` scratch directory.
- Rationale: Readers should be able to move between the papers and the repo without guessing which parts are ‚Äúpaper law‚Äù vs ‚Äúengine law,‚Äù and any deviation should be documented with rationale to keep the repo backlog honest.
- Consequence: THEORY becomes an onboarding bridge and drift detector; future changes that diverge from the papers have a clear place to document rationale.
  - Evidence: `c029c82`

## 2025-12-30 ‚Äî PR #162: CodeRabbit doc nits (prose/markdown)

- Context: CodeRabbit review requested small readability tweaks and markdownlint-sensitive cleanup in `docs/THEORY.md`.
- Decisions:
  - Tighten minor wordiness/repetition without changing meaning.
  - Keep formatting conservative (no trailing whitespace; blank lines around headings).
- Rationale: Keep the ‚Äúpaper bridge‚Äù doc readable and reduce review noise without churn.
- Consequence: Same technical content, slightly tighter prose; markdownlint nits avoided.
  - Evidence: `22ba855`
