\documentclass[11pt]{article}
\usepackage[a4paper,margin=1in]{geometry}
\usepackage{microtype,mathtools}
\usepackage{rmg-macros}
\input{rmg-diagrams.tex}

\title{Confluence \& Two-Plane Commutation for Recursive Metagraphs (RMG) under DPOI}
\author{RMG Core Project}
\date{\today}

\begin{document}
\maketitle

\section{Setting: typed open graphs are adhesive}
Fix a type set $T$. $\GraphT$ is the category of $T$-typed directed graphs; an \emph{open graph} is a cospan of monos $I\to G \leftarrow O$. Objects and boundary-preserving arrows form the adhesive category $\OGraphT$: pushouts along monos exist, are stable under pullback, and satisfy Van Kampen.

\section{DPOI rules and steps}
A \emph{rule} is a span of monos $p=(L \xleftarrow{\ell} K \xrightarrow{r} R)$ in $\OGraphT$.
A \emph{match} is a boundary-preserving mono $m:L\mono G$ satisfying the DPO gluing conditions (dangling \& identification). The step $G\To_p H$ is the usual double square:
\[\DPO{K}{L}{R}{D}{G}{H}.\]
Typed ports are enforced by restricting matches to boundary-preserving morphisms; when typing fails, the pushout complement does not exist and the match is rejected.

\section{RMG state and two planes}
An RMG state is $(G;\alpha,\beta)$ with skeleton $G\in\OGraphT$ and attachments $\alpha(v)$, $\beta(e)$ in fibers over nodes/edges. A \emph{tick} applies any number of DPO steps in attachments (fibers), then a batch of DPO steps on $G$ (base), subject to the invariant \textbf{no-delete-under-descent}: no base step deletes (or clones) a position whose attachment is updated in the same tick.

\section{Scheduler independence}
For $m:L\mono G$ of $p=(L\leftarrow K\to R)$, define $\Del(m)=m(L\setminus K)$ and $\Use(m)=m(L)$. Matches $m_1,m_2$ are \emph{parallel independent} iff $\Del(m_1)\cap \Use(m_2)=\varnothing$ and $\Del(m_2)\cap \Use(m_1)=\varnothing$ (and gluing holds). The scheduler computes a maximal independent set using an over-approximate \emph{touch set} $\Use(m)\cup \Halo_r(\Use(m))$.

\section{Main results}
\begin{theorem}[Tick determinism]\label{thm:tick}
Given a scheduler-admissible batch (pairwise parallel independent in the base; attachments under no-delete-under-descent), applying the batch in any serial order consistent with attachments-first yields a unique result up to typed open-graph isomorphism.
\end{theorem}
\begin{proof}[Sketch]
By the Concurrency Theorem for DPO in adhesive categories, independent base steps commute (order-independence). Attachment steps commute in the product of fibers; applied first, they are unaffected by base updates.
\end{proof}

\begin{theorem}[Two-plane commutation]\label{thm:plane}
Under no-delete-under-descent, performing all attachment updates then base updates equals (up to iso) performing base updates then transporting and applying attachment updates in the new fibers.
\end{theorem}
\begin{proof}[Sketch]
Base updates are pushouts along monos in $\OGraphT$. Reindexing along base monos preserves pushouts in fibers (Van Kampen). Hence the square ``attachments vs base'' commutes up to isomorphism.
\end{proof}

\begin{theorem}[Conditional global confluence]\label{thm:global}
Let $R$ be a finite DPOI rule set. If all DPOI critical pairs of $R$ are joinable (modulo boundary iso) and rewriting terminates (or admits a decreasing-diagrams labelling), then $\Rightarrow_R$ is confluent.
\end{theorem}

\paragraph{Engineering corollaries.}
Theorem~\ref{thm:tick} justifies deterministic ticks (stable replay); Theorem~\ref{thm:plane} justifies the journal/epoch split (attachments-first is correct); Theorem~\ref{thm:global} can be certified per rule-pack via a critical-pair analyzer.
\end{document}
